use super::*;
use math_util::{round, feq};
use crate::{
    Point,  pts,
    Polygon, LineString, ln,
    GeomType, Geometry, convex_hull,
};
use crate::distance::{min_dist_brute_force, knn_min_linear_distance};
use crate::inter::OTHER_A;
use std::cmp::Ordering;

#[test]
#[should_panic]
fn test_construct_0() {
    let _ln = LineString::new(vec![]);
}

#[test]
#[should_panic]
fn test_construct_1() {
    let coords: Vec<Point> = vec![];
    let _ln = LineString::from_vec(coords);
}

#[test]
#[should_panic]
fn test_construct_2() {
    let _ln = LineString::from_wkt("Segment(5.6 7.9, 5.6 7.9)");
}

#[test]
#[should_panic]
fn test_construct_3() {
    let pts = pts![[5.6, 7.9], [5.6, 8.9], [6.6, 8.9], [6.6, 7.9], [5.6, 7.9]];
    let ln: LineString = (&pts).into();
    let _rings = ln.linear_rings();
}

#[test]
#[should_panic]
fn test_construct_4() {
    let _ply: Polygon = "LINESTRING(5.6 7.9,5.6 8.9,6.6 8.9,6.6 7.9,5.6 7.9)".into();
}

#[test]
#[should_panic]
fn test_construct_5() {
    let _ply: Polygon = "Polygon(5.6 7.9,5.6 8.9,6.6 8.9,6.6 7.9,5.6 7.9)".into();
}

#[test]
fn test_to_array_and_re_construct() {
    let pts = pts![[5.6, 7.9], [5.6, 8.9], [6.6, 8.9], [6.6, 7.9], [5.6, 7.9]];
    let pt_array = vec![[5.6, 7.9, ], [5.6, 8.9, ], [6.6, 8.9, ], [6.6, 7.9, ], [5.6, 7.9, ]];
    let mut ln: LineString = (&pts).into();
    assert!(!ln.geom_type().is_point());
    assert_eq!(format!("{}", ln.geom_type()), "LineString".to_string());
    assert!(ln.geom_type().is_line_string());
    assert_eq!(ln.as_array(), pt_array);
    assert_eq!(ln.clone().as_array(), pt_array);
    ln.re_construct();
    assert_eq!(ln.as_array(), pt_array);
}

#[test]
fn test_wkt_construct() {
    let ln = ln![[5.6, 7.9], [5.6, 8.9], [6.6, 8.9], [6.6, 7.9], [5.6, 7.9]];
    let ln_str = "LINESTRING(5.6 7.9,5.6 8.9,6.6 8.9,6.6 7.9,5.6 7.9)".to_string();
    assert_eq!(ln.wkt(), ln_str);
    let ln_2: LineString = ln_str.as_str().into();
    assert_eq!(ln.wkt(), ln_2.wkt());
}

#[test]
fn test_bounds() {
    let pts = pts![[5.6, 7.9], [5.6, 8.9], [6.6, 8.9], [6.6, 7.9], [5.6, 7.9]];
    let _pt_array = vec![[5.6, 7.9, ], [5.6, 8.9, ], [6.6, 8.9, ], [6.6, 7.9, ], [5.6, 7.9, ]];
    let ln: LineString = (&pts).into();
    let mut bbox = MBR::new_from_pt(pts[0].as_array());
    pts[1..].iter().for_each(|v| { bbox.expand_to_include_point(v.as_array()); });
    assert!(ln.bbox().equals(&bbox));
}

#[test]
fn test_length() {
    let pts = pts![[5.6, 7.9], [5.6, 8.9], [6.6, 8.9], [6.6, 7.9], [5.6, 7.9]];
    let _pt_array = vec![[5.6, 7.9, ], [5.6, 8.9, ], [6.6, 8.9, ], [6.6, 7.9, ], [5.6, 7.9, ]];
    let _pt_array2 = pts![[5, 7], [5, 8], [6, 8], [6, 7 ], [5, 7]];

    let ln2 = pts![[5.538, 8.467], [5.498, 8.559], [5.858, 8.987], [6.654, 8.638], [6.549, 8.024], [5.765, 8.082], [5.538, 8.467]];
    let ln2 = LinearRing::new(ln2.clone());
    let ln3 = ln![[5.538, 8.467], [5.498, 8.559], [5.858, 8.987], [6.654, 8.638], [6.549, 8.024], [5.765, 8.082]];

    let ln: LineString = (&pts).into();
    let ply = Polygon::new(vec![ln2.coordinates().clone()]);

//    let cln = ln.clone();
    let pt_lnstr = LineString::from_point(pts[0].into());

    //should test length
    assert!(ln.geom_type().is_line_string());
    assert_eq!(std::mem::discriminant(&ln.geom_type()), std::mem::discriminant(&GeomType::LineString));
    assert_eq!(ln.length(), 4.0);

    assert_eq!(pt_lnstr.length(), 0.0);
    assert_eq!(ln.area(), 0.0);
    assert_eq!(ln.len(ln.coordinates.len() - 1, 0), ln.length());
    assert_eq!(ln3.area(), 0.0);
    assert_eq!(ln2.area(), ply.area());
}

#[test]
fn test_line_string_relate() {
    let coords = pts![[0.5, 0.5], [0.06, -0.1], [0.26, -0.61], [0, -1], [-1.5, -1.], [-0.5, -0.5]];
    let coords2 = pts![[0.64, 1.72], [1.18, 1.87], [1.68, 1.43], [0.54, 1.38]];
    let plywkt = "POLYGON (( 0.64 1.72, 1.18 1.87, 1.68 1.43, 0.54 1.38, 0.64 1.72 ), (0.9471 1.5300, 0.9471 1.7102, 1.0653 1.7102, 1.0653 1.5300, 0.9471 1.5300 ))";
    let plywktc = "POLYGON (( 0.9694190834241365 1.6351888097521738, 0.9963995357624527 1.6647388289798535, 1.013101720543315 1.6467518607543095, 1.032373472213541 1.6608844786458083, 1.0465060901050398 1.6454670773096276, 1.0278767301571547 1.6313344594181287, 1.0400821728816312 1.6152746663596074, 0.9880484433720215 1.6094931408585396, 0.9694190834241365 1.6351888097521738 ))";

    let plywktd = "POLYGON (( 1.06137745847723 1.0766292071767967, 0.9394836291630517 0.8815990802741116, 1.3140301228738902 0.7752190110544651, 1.593277804575462 1.0034929095882898, 1.2453263281695353 1.185225527838519, 1.06137745847723 1.0766292071767967 ),( 1.2364613224012313 1.0832779615030246, 1.1212162474132812 1.0012766581462138, 1.2364613224012313 0.9303566119997828, 1.3472738945050298 0.9613841321888464, 1.4093289348831568 1.0300879268932013, 1.3384088887367258 1.0877104643871764, 1.2364613224012313 1.0832779615030246 ),( 1.1721900305810282 0.850571560085048, 1.1721900305810282 0.8838153317161875, 1.3517063973891816 0.8838153317161875, 1.3517063973891816 0.850571560085048, 1.1721900305810282 0.850571560085048 ))";
    let plywkte = "POLYGON (( -0.2405548235983036 -0.1291889913629033, 0.3266242131459507 0.0813804713804726, 0.5032308593178143 -0.0442819499341227, 0.5747608247298315 -0.5006764018668276, 0.3368130581174044 -0.6318386766212843, 0.3979461279461264 -0.2718328209632546, 0.224735763431414 -0.1461703996486594, -0.2099882886839426 -0.292210510906162, -0.2405548235983036 -0.1291889913629033 ))";
    let plywktf = "POLYGON (( -0.277913921826967 -0.5367427902210501, -0.4850871029131916 -0.6997643097643087, -0.3424432733128402 -0.8152378861074503, -0.2337622602840011 -0.7303308446786697, -0.1080998389694059 -0.8661821109647186, 0.0141663006880382 -0.7371234079929722, -0.1182886839408595 -0.5842907334211672, -0.277913921826967 -0.5367427902210501 ))";
    let plywktg = "POLYGON (( 0.1161332552173457 -0.4654208754208744, 0.1161332552173457 -0.2431398008042315, 0.2824725516029848 -0.2431398008042315, 0.2824725516029848 -0.4654208754208744, 0.1161332552173457 -0.4654208754208744 ))";

    let lna = LineString::new(coords);
    let lnb = LineString::new(coords2.clone());
    let plya = Polygon::from_vec(&coords2);

    let plyb = Polygon::from_wkt(plywkt);
    let plyc = Polygon::from_wkt(plywktc);
    let plyd = Polygon::from_wkt(plywktd);
    let plye = Polygon::from_wkt(plywkte);
    let plyf = Polygon::from_wkt(plywktf);
    let plyg = Polygon::from_wkt(plywktg);

    assert!(lna.bbox().equals(&lna.bbox()));
    assert!(!lna.intersects(&lnb));
    assert!(!lna.intersects(&plya));
    assert!(!lna.intersects(&plya));

    assert!(!plyb.intersects(&plyc));

    assert!(!plya.intersects(&lna));
    assert!(!plyb.intersects(&lna));

    assert!(!plyd.intersects(&plyb));
    assert!(!plyb.intersects(&plyd));

    assert!(!plyd.intersects(&plyc));
    assert!(!plyc.intersects(&plyd));

    assert!(!plye.intersects(&plyg));
    assert!(!plyg.intersects(&plye));

    assert!(!lna.intersects(&plyb));
    assert!(lna.intersects(&plye));
    assert!(!lna.intersects(&plyf));
}

#[test]
fn test_line_string_mono() {
    let pts = pts![[5.78, 8.07], [6.44, 9.09], [7.87, 9.61]];
    let ln = LineString::new(pts.clone());
    let n = ln.coordinates.len();

    let (a, b) = (pts[0], pts[(n - 1)]);
    let bounds = MBR::new_from_bounds(a.as_array(), b.as_array());
    let mbox = MonoMBR { mbr: bounds, i: 0, j: n - 1 };
    assert_eq!(mbox.i, ln.bounds.i);
    assert_eq!(mbox.j, ln.bounds.j);
    assert_eq!(ln.bbox(), *mbox.bbox());
    assert_eq!(ln.bbox(), *mbox.bbox());
    assert_eq!(ln.bounds.mbr, mbox.mbr);
}

#[test]
fn test_geometry_intersection() {
    let lnwkt = pts![[350, 710], [400, 770], [450, 770], [480, 810], [570, 820], [670, 730], [720, 760], [930, 800]];
    let lnwkt2 = "LINESTRING ( 620 620, 720 690, 790 680, 820 630, 870 630, 910 600, 900 530, 800 450, 730 390, 680 420, 640 460, 600 480, 650 540, 690 570, 780 570, 730 630, 680 600, 610 570, 550 610 )";

    let plywkt = "POLYGON (( 720 760, 860 770, 950 700, 930 640, 800 600, 740 580, 730 500, 760 440, 720 360, 620 390, 510 480, 460 570, 440 630, 450 740, 480 810, 570 820, 570 770, 580 740, 670 730, 720 760 ), ( 630 670, 580 650, 590 600, 650 580, 710 600, 710 670, 630 670 ), ( 780 650, 800 640, 850 710, 830 720, 780 650 ))";
    let plywkt2 = "POLYGON (( 860 920, 950 880, 860 800, 930 720, 880 690, 830 700, 810 730, 790 790, 820 840, 810 870, 860 920 ), ( 840 750, 860 750, 850 800, 830 800, 840 750 ))";

    let pt_awkt = "POINT ( 620 620 )";
    let pt_bwkt = "POINT ( 710 600 )";
    let pt_cwkt = "POINT ( 722.1298042987639 582.0334837046336 )";
    let pt_dwkt = "POINT ( 720 360 )";
    let pt_ewkt = "POINT ( 730 600 )";
    let pt_fwkt = "POINT ( 680 630 )";
    let pt_gwkt = "POINT ( 780 660 )";
    let pt_hwkt = "POINT ( 630 570 )";

    let poly_awkt = "POLYGON ((730 410, 920 500, 930 540, 930 580, 900 640, 810 650, 750 520, 730 410))";
    let poly_bwkt = "POLYGON ((630 620, 730 410, 890 410, 1040 510, 1080 620, 1020 720, 690 720, 630 620))";

    let ln = LineString::from_vec(lnwkt.clone());
    let ln2 = LineString::from_wkt(lnwkt2);
    let ply = Polygon::from_wkt(plywkt);
    let ply2 = Polygon::from_wkt(plywkt2);

    let ply_a = Polygon::from_wkt(poly_awkt);
    let ply_b = Polygon::from_wkt(poly_bwkt);

    let pt_a = Point::from_wkt(pt_awkt);
    let pt_b = Point::from_wkt(pt_bwkt);
    let pt_c = Point::from_wkt(pt_cwkt);
    let pt_d = Point::from_wkt(pt_dwkt);
    let pt_e = Point::from_wkt(pt_ewkt);
    let pt_f = Point::from_wkt(pt_fwkt);
    let pt_g = Point::from_wkt(pt_gwkt);
    let pt_h = Point::from_wkt(pt_hwkt);

    let seg_aa = Segment::new(pt_a, pt_a);
    let seg_ab = Segment::new(pt_a, pt_b);
    let len = |v: Vec<Point>| v.len();
    //"Intersection with pt, seg, ln, poly"
    let inters = ply_a.intersection(&ply_b);
    assert_eq!(inters.len(), 7);

    assert_eq!(ply.intersection(&ln).len(), 4);
    assert_eq!(ply.intersection(&ln2).len(), 22);
    assert_eq!(ply.intersection(&ply2).len(), 13);

    assert_eq!(len(pt_a.intersection(&ply)), 0);
    assert_eq!(len(ply.intersection(&pt_a)), 0);

    assert_eq!(len(ply.intersection(&pt_b)), 1);
    assert_eq!(len(pt_b.intersection(&ply)), 1);

    assert_eq!(len(seg_aa.intersection(&ply)), 0);
    assert_eq!(len(ply.intersection(&seg_aa)), 0);
    assert_eq!(len(seg_ab.intersection(&ply)), 1);

    assert_eq!(len(pt_a.intersection(&ln)), 0);
    assert_eq!(len(ln.intersection(&pt_a)), 0);
    assert_eq!(len(seg_ab.intersection(&pt_a)), 1);
    assert_eq!(len(pt_a.intersection(&seg_ab)), 1);
    assert_eq!(len(ply.intersection(&seg_ab)), 1);

    assert_eq!(len(ply.intersection(&pt_c)), 1);
    assert_eq!(len(pt_c.intersection(&ply)), 1);

    assert_eq!(len(ply.intersection(&pt_d)), 1);
    assert_eq!(len(pt_d.intersection(&ply)), 1);

    assert_eq!(len(pt_a.intersection(&pt_b)), 0);
    assert_eq!(len(pt_a.intersection(&pt_a)), 1);
    assert_eq!(len(pt_a.intersection(&ln2)), 1);

    assert_eq!(len(ln2.intersection(&pt_a)), 1);
    assert_eq!(len(ln2.intersection(&pt_b)), 0);
    assert_eq!(len(ln2.intersection(&pt_e)), 0);
    assert_eq!(len(ln2.intersection(&pt_f)), 0);
    assert_eq!(len(ln2.intersection(&pt_g)), 0);
    assert_eq!(len(ln2.intersection(&pt_h)), 0);
}


#[test]
fn test_polygon() {
    let sh = pts![[35, 10], [45, 45], [15, 40], [10, 20], [35, 10]];
    let h1 = pts![[20, 30], [35, 35], [30, 20], [20, 30]];
    let poly0 = Polygon::new(vec![sh.clone()]);
    let poly = Polygon::new(vec![sh.clone(), h1.clone()]);

    let wkt = "POLYGON (( 33.52991674117594 27.137460594059416, 33.52991674117594 30.589750223527805, 36.44941148514852 30.589750223527805, 36.44941148514852 27.137460594059416, 33.52991674117594 27.137460594059416 ))";
    let ply_inpoly = Polygon::from_wkt(wkt);
    let ply_inpoly_clone = ply_inpoly.clone();
    assert!(poly.geom_type().is_polygon());
    assert_eq!(format!("{}", poly.geom_type()), "Polygon".to_string());
    assert!(!poly.geom_type().is_line_string());

    assert!(poly.shell().bbox().equals(poly.shell().bbox()));

    let bbox = poly.bbox();
    let bounds = poly.bounds();

    assert!(bbox.equals(poly.shell().bbox()));
    assert!(bounds.equals(poly.shell().bbox()));
    assert!(poly.intersects(&ply_inpoly));
    assert!(poly.intersects(&ply_inpoly));
    assert!(poly.intersects(&ply_inpoly_clone));

    assert_eq!(poly.wkt(), "POLYGON((35 10,45 45,15 40,10 20,35 10),(20 30,35 35,30 20,20 30))".to_string());
    assert_eq!(poly0.wkt(), "POLYGON((35 10,45 45,15 40,10 20,35 10))".to_string());
    assert_eq!(poly.wkt(), "POLYGON((35 10,45 45,15 40,10 20,35 10),(20 30,35 35,30 20,20 30))".to_string());
    let shells = poly.coordinates();
    assert_eq!(shells, [sh, h1]);
}

#[test]
fn test_polygon_holes_chull() {
    let ply = "POLYGON((5.6 7.9,5.6 8.9,6.6 8.9,6.6 7.9,5.6 7.9),(5.81 8.43,5.84 8.68,6.3 8.77,6.42 8.52,6.36 8.19,5.96 8.14,5.81 8.43))";
    let gply = Polygon::from_wkt(ply);
    assert_eq!(format!("{}", gply), ply);
    assert_eq!(format!("{}", gply.wkt_string()), ply);
    assert_eq!(format!("{}", gply.wkt()), ply);
    assert_eq!(round(gply.area(), 5), 0.7025);
    let arr = pts![ [5.89, 8.64], [5.87, 8.74], [5.91, 8.86], [6.1310016380016386, 8.896833606333606], [6.33, 8.93],
	    [6.36, 8.77], [6.58, 8.78], [6.65, 8.61], [6.57, 8.36],
	    [6.32, 8.5], [6.21, 8.34], [5.94, 8.29], [5.78, 8.5]
	];

    let harr = convex_hull(&arr);
    let hply = Polygon::from_vec(&harr);
    assert_eq!(harr.len(), 8);
    assert_eq!(round(hply.area(), 6), 0.41995);


    let arr2 = pts![
	    [5.89, 8.64], [5.78, 8.5], [5.94, 8.29], [6.21, 8.34],
	    [6.32, 8.5], [6.57, 8.36], [6.65, 8.61], [6.58, 8.78],
	    [6.36, 8.77], [6.33, 8.93], [6.1310016380016386, 8.896833606333606],
	    [5.91, 8.86], [5.87, 8.74]
	];

    let harr = convex_hull(&arr2);
    let hply = Polygon::from_vec(&harr);
    assert_eq!(harr.len(), 8);
    assert_eq!(round(hply.area(), 6), 0.41995);

    let arr3 = pts![
				[5.01, 8.74], [5.01, 8.74], [5.10, 8.59], [5.29, 8.62], [5.30, 8.50],
				[5.65, 8.58], [5.46, 8.66], [5.67, 8.79], [5.67, 8.79], [5.63, 9.07],
				[5.27, 9.04], [5.40, 8.88], [5.15, 8.84], [5.15, 8.84], [5.02, 8.76],
				[5.01, 8.74]
			];

    let harr = convex_hull(&arr3);
    let hply = Polygon::from_vec(&harr);

    assert_eq!(harr.len(), 8);
    assert_eq!(round(hply.area(), 6), 0.27795);

    let wkt_data = "POLYGON (( 2958200.37460972 4491861.80361633, 2958440.524147205 4491771.742896985, 2958650.6508180276 4491855.793940935, 2958392.489786923 4491435.5314368345, 2958344.4665586017 4490973.249489654, 2958254.409090545 4490570.993055433, 2958440.524147205 4490372.868021447, 2958896.81160802 4490300.818387367, 2959184.9843738303 4490192.758868743, 2959377.1106829904 4490192.758868743, 2959575.2371127047 4490342.8519493975, 2959755.3409168646 4490282.806056019, 2959821.3867707513 4490054.67120602, 2959911.4442388006 4490156.734607343, 2960109.570668515 4490162.743311103, 2960169.6052699015 4489982.623753354, 2960373.73182017 4489904.582240969, 2960397.7434343323 4490018.647417948, 2960613.881357655 4490120.710469432, 2960739.9618129283 4490048.662564043, 2960727.950439874 4489856.541899648, 2960625.8927307166 4489856.541899648, 2960499.812275443 4489766.484358743, 2960649.904344879 4489478.305413313, 2960757.9733065367 4489184.126221187, 2960884.05376181 4489154.11354389, 2960938.0882426426 4489256.168200422, 2961064.168697916 4489178.1180768795, 2961040.1459518 4488998.015391916, 2960962.099856805 4488757.864606198, 2961052.1573248617 4488547.730167106, 2961088.1803120784 4488229.532583475, 2960974.1112298667 4488091.44270239, 2961016.1343376376 4487857.292005297, 2961052.1573248617 4487617.139270764, 2961172.2265276276 4487623.146523006, 2961322.329729017 4487743.222273178, 2961502.4335331656 4487479.057432961, 2961754.594443716 4487358.9846996665, 2961814.6290450953 4487214.899229713, 2962054.778582584 4487106.829421867, 2962078.8013286963 4486902.692814201, 2962306.939493127 4486866.679825705, 2962667.169365339 4486824.646159198, 2962709.19247311 4486662.547880143, 2962661.158112839 4486422.394428901, 2962469.0429356247 4486392.375633124, 2962427.0198278464 4486170.2336072065, 2962126.8245570287 4486182.246461991, 2961892.6862720437 4486254.295876682, 2961814.6290450953 4486476.425676972, 2961670.548228167 4486416.387862626, 2961460.410425391 4486152.228351723, 2961442.3989317827 4485966.115180336, 2961340.341222625 4485972.121489432, 2961130.2034198567 4486206.258211695, 2961124.2032993026 4486386.369083997, 2961232.27226096 4486440.414148316, 2961238.2723815143 4486602.5090031475, 2961112.191926241 4486824.646159198, 2960968.099977359 4486998.760724742, 2960769.9846795984 4486998.760724742, 2960493.8010229394 4487154.857198816, 2960277.674231559 4487160.864186946, 2960079.547801852 4487256.920453876, 2959971.478840187 4487533.094111022, 2959755.3409168646 4487533.094111022, 2959581.237233259 4487389.00625509, 2959455.1567779854 4487389.00625509, 2959221.0073610544 4487623.146523006, 2959088.926785227 4487665.169378828, 2958962.8463299535 4487623.146523006, 2958878.8001144044 4487707.206405647, 2958746.7084066346 4487719.207013436, 2958686.6738052443 4487653.168832723, 2958554.5932294168 4487929.338895369, 2958452.5243883096 4487941.353760056, 2958362.47805221 4488019.394701414, 2958242.397717491 4488103.44374878, 2958110.3171416633 4488091.44270239, 2957948.213699173 4487893.322390255, 2957676.916968163 4487873.605786528, 2957654.7309936434 4488101.427235939, 2957565.4416300803 4488149.935679749, 2957468.827444017 4488147.120951578, 2957428.796955131 4488137.472461212, 2957280.307886362 4488045.791239213, 2957228.766962122 4488005.853373263, 2957176.524725098 4487936.312556416, 2957242.5037872866 4487749.6636932865, 2957299.811061144 4487491.071783088, 2957524.665300604 4487345.038148042, 2957631.7657826915 4487163.944695003, 2957434.652360346 4487012.04871792, 2957285.461978782 4487023.124392081, 2957169.522729125 4487067.455209766, 2957137.707618654 4487034.774165612, 2957028.3250869997 4486921.021400422, 2956921.5251675323 4486988.0071240105, 2956710.441149097 4486946.883103915, 2956580.3086643554 4486964.399648484, 2956399.9042975716 4487044.197609656, 2956369.402757097 4487057.177612528, 2956336.8640699387 4487047.068051189, 2956246.4615114667 4486970.47653807, 2956176.6975865886 4486865.71369357, 2956166.489589285 4486806.471761156, 2956164.029428534 4486768.512853928, 2956183.321096286 4486720.108795125, 2956286.1023821346 4486635.776771374, 2956442.205704078 4486528.398987088, 2956696.1365945227 4486312.960650049, 2956734.0742769875 4486214.574830495, 2956613.2035738863 4486229.2059350945, 2956582.368074935 4486194.287332542, 2956630.9924285114 4486162.743081156, 2956648.692227546 4486079.269579906, 2956585.985958386 4486078.415527049, 2956581.8448733278 4486024.610336591, 2956603.140291918 4485992.632570837, 2956682.8784431703 4485744.752181314, 2956646.1318792626 4485637.76150199, 2956652.7219931185 4485496.961634614, 2956708.459662158 4485356.471650045, 2956652.7219931185 4485326.245898671, 2956515.0643107966 4485401.537440658, 2956398.5016719922 4485502.365671504, 2956245.3037887663 4485569.594362542, 2956159.8772115223 4485513.859759193, 2956112.9003864154 4485485.957568087, 2956068.606361024 4485384.849495683, 2956056.0383905135 4485291.288294539, 2956093.508531116 4485180.158324789, 2956176.486079555 4485121.401872754, 2956361.0649272352 4485119.20393702, 2956494.971142713 4484922.021572173, 2956700.055040598 4484854.783020917, 2956821.994410813 4484758.174728554, 2956533.0758044124 4484481.807956379, 2956451.623332996 4484690.0692855045, 2956254.6991537847 4484771.487889297, 2956073.727057606 4484678.954071082, 2956095.0670039915 4484527.97590499, 2955979.717747625 4484458.066118699, 2955967.505999487 4484300.973776508, 2955774.63384974 4484221.210624784, 2955647.1507688835 4484318.359928127, 2955608.122155413 4484481.625972748, 2955487.997292895 4484580.345554691, 2955264.1115330085 4484702.93439091, 2955197.553609468 4484804.385887679, 2955157.7234956585 4484932.941052664, 2955098.6573738456 4484948.648325261, 2955128.3685459346 4485025.981086012, 2955184.339985907 4485006.955830194, 2955217.05678425 4485084.2750201, 2955163.857199602 4485107.192296393, 2955178.484580692 4485141.939294368, 2955096.1860811487 4485178.520363491, 2955049.353971377 4485073.901364107, 2955058.137079194 4485048.66024388, 2955050.823388651 4485042.444469821, 2955042.4076351486 4485072.809400916, 2955093.9819552302 4485199.001897864, 2955053.7844871096 4485213.771586835, 2954930.25324817 4485195.473975223, 2954829.520240959 4485124.383786283, 2954861.112712443 4485114.682070699, 2954834.6298055835 4484903.234492511, 2954860.589510832 4484786.928937003, 2954894.9761015438 4484782.883184321, 2954809.0151907466 4484661.819305111, 2954730.6685331278 4484535.4932645, 2954723.800120551 4484501.798177294, 2954726.727823153 4484462.293729741, 2954745.3181781173 4484435.220250014, 2954781.619464062 4484387.736838542, 2954804.929765437 4484357.457876455, 2954861.3130875267 4484398.025826082, 2954936.3869521134 4484336.264054708, 2955058.2706625834 4484261.526076917, 2955027.457427539 4484203.376685869, 2955138.3093764633 4484165.091212697, 2955172.1393697187 4484204.7065311335, 2955182.3807628714 4484199.807102043, 2955156.1204949953 4484158.414016474, 2955240.211238336 4484014.092425257, 2955424.389335852 4483826.309342172, 2955746.837372888 4483528.424917955, 2955919.0931529365 4483527.501084827, 2956217.2624090314 4483465.142536212, 2956406.694786515 4483213.570488296, 2956402.2420068793 4483165.364746906, 2956348.207526047 4483051.289902974, 2956393.625878293 4482861.676454034, 2956424.7062801234 4482732.628729343, 2956604.7544245347 4482637.9854062535, 2956707.836273007 4482632.400888935, 2956796.6692266613 4482659.567704022, 2956799.652589012 4482720.549831342, 2956772.9470431767 4482768.109697629, 2956765.143546868 4482857.197547704, 2956931.7888245843 4482936.026577592, 2957106.026091572 4482683.22150534, 2957083.873512905 4482629.475666769, 2957112.749788817 4482574.218512684, 2957180.565622613 4482563.819339078, 2957317.2102975585 4482503.733871017, 2957366.268797148 4482399.75728998, 2957472.779285945 4482321.7580335885, 2957589.453244243 4482419.967491277, 2957861.1618573703 4482111.696161047, 2958047.2769140303 4482045.665185388, 2957957.2194459736 4481961.608548742, 2957987.2423126437 4481877.552583486, 2958197.368983466 4481565.364585221, 2958197.368983466 4481421.27448111, 2958041.276793476 4481421.27448111, 2957975.2309395894 4481499.32304262, 2957819.138749592 4481499.32304262, 2957612.307135705 4481193.3177774325, 2957393.486412648 4481258.545721561, 2957317.6333116256 4481212.056250781, 2957314.7390048616 4481151.600653738, 2957345.374128733 4481107.700591765, 2957298.263720222 4481082.357030809, 2957259.246238701 4481132.134585172, 2957290.304376632 4481182.654075604, 2957212.3362052813 4481282.980065163, 2957012.3507400714 4481467.233076271, 2956926.990954537 4481482.277422495, 2956867.301443573 4481461.383280478, 2956767.904270243 4481414.487068556, 2956756.438362688 4481403.0114531815, 2956735.9667083286 4481376.827504445, 2956699.0086373873 4481299.423598666, 2956694.7451008894 4481277.242327608, 2956692.963989038 4481267.991981689, 2956730.7792200632 4481190.8967523165, 2956724.1891062073 4481101.948955517, 2956685.0491732433 4481047.245594136, 2956676.22153762 4480896.1935830675, 2956706.1998764947 4480790.665573843, 2956672.091584511 4480747.816550277, 2956664.7444981225 4480738.020912949, 2956661.2935939096 4480721.158444341, 2956663.575643465 4480675.552948788, 2956684.9935134985 4480630.983178575, 2956727.562086772 4480576.786032528, 2956815.582408149 4480544.307060655, 2956871.7987509966 4480544.894787826, 2956882.340706773 4480611.070277877, 2956914.2114769854 4480631.878770217, 2956993.715857312 4480589.226302933, 2956929.195080448 4480534.357684325, 2956896.400358461 4480457.05792756, 2956855.991383303 4480400.258920658, 2956696.426025197 4480232.522425398, 2956646.3879140913 4480147.178921051, 2956659.2230513766 4480101.212096449, 2956605.333285887 4479976.228125811, 2956674.128731195 4479861.880006954, 2956681.7318524197 4479715.784321655, 2956656.4734599553 4479444.377194364, 2956691.1049535424 4479326.886677541, 2956762.3271637484 4479243.649280667, 2956850.870686725 4479206.081432559, 2957008.7105927244 4479145.511430152, 2957152.802541606 4479055.251719654, 2957317.611047726 4479030.822546471, 2957412.1101634577 4479000.60096737, 2957735.081402097 4478878.680162925, 2957867.1619779244 4478710.576159038, 2958071.288528193 4478602.509717282, 2958065.2884076387 4478272.301136702, 2957987.2423126437 4478230.273806676, 2957903.1849651486 4477936.087193102, 2958005.253806252 4477804.008079294, 2958005.253806252 4477503.817902811, 2957939.2079523653 4477263.663528938, 2957975.2309395894 4477071.5523660295, 2958095.3112743087 4476933.4549605325, 2958095.3112743087 4476831.3938601315, 2957939.2079523653 4476843.410048515, 2957855.1506048664 4477005.511028755, 2957689.295695532 4476930.531321503, 2957452.9978124276 4476939.148365188, 2957339.507591564 4476934.112429712, 2957085.031235613 4476972.161779616, 2956782.0418455712 4476922.110126529, 2956530.537720021 4476649.418126509, 2956451.044471644 4476663.658254251, 2956359.8404128402 4476709.721982025, 2956133.316381026 4476876.395185597, 2956044.049281355 4477146.267286472, 2955844.2753231786 4477335.288189974, 2955204.978619501 4477370.639056716, 2954753.188466113 4477502.600819591, 2954562.787609067 4477684.171604738, 2954768.0162222907 4477947.447109513, 2954927.5927123465 4477917.956120376, 2954967.990555551 4477953.616724424, 2954994.7517611384 4478004.722539749, 2955013.3532480486 4478088.048074648, 2955003.5682648085 4478162.770207245, 2954915.080401581 4478166.925338589, 2954850.9937707298 4478285.242342338, 2954771.0107165948 4478324.038073573, 2955009.3791422285 4478665.539012842, 2954985.3563961163 4478911.69965842, 2955165.471332215 4478809.633374605, 2955375.609134987 4478821.637829304, 2955432.7939574122 4478858.182943452, 2955557.4829190485 4478834.565718893, 2955823.5587659404 4479073.958404336, 2955948.114144195 4479002.237967346, 2956107.100640945 4479082.311362527, 2956233.3146796003 4479196.776939683, 2956272.432348665 4479325.025756951, 2956285.4678610414 4479456.396364875, 2956233.7154297717 4479575.833244909, 2956176.6975865886 4479578.827579599, 2956127.3941841163 4479691.605478384, 2956071.6119872816 4479747.295258611, 2955967.2054368593 4479773.349221762, 2955834.5237357877 4479727.495968826, 2955652.5831600316 4479678.382696964, 2955453.2322159223 4479676.689622443, 2955324.9142388813 4479872.668304313, 2955170.04656329 4480036.760929413, 2954981.115123518 4480118.199508395, 2954741.80048221 4480192.60021795, 2954596.5062828287 4480080.866418384, 2954437.018848367 4480035.51556772, 2954378.4981920607 4479922.845926028, 2954286.503764864 4479865.699986465, 2954336.9537580907 4479542.098065689, 2953826.631816447 4479194.832091831, 2953430.390088968 4479253.91924832, 2953105.3037800044 4479242.082202014, 2953004.125494823 4479392.005113315, 2953032.3672496416 4479501.506854795, 2953042.5975108445 4479593.001708198, 2953004.125494823 4479722.206836231, 2952902.535327524 4479915.975523651, 2952808.692996789 4480234.243575495, 2952985.034202151 4480108.95018103, 2953398.218756132 4480349.53328665, 2953458.1643019244 4480542.865729891, 2953480.539519571 4480763.55955793, 2953431.9262979403 4481069.986148566, 2953315.5862981156 4481326.125152901, 2953318.0019310676 4481559.542724591, 2953311.734643735 4481627.991775248, 2953384.7713616453 4481676.470374454, 2953443.314281851 4481795.456612829, 2953403.317188807 4481825.5462652, 2953539.015648082 4481942.784768578, 2953575.528441068 4481927.039996903, 2953636.5983137153 4482012.03405289, 2953675.0035380423 4482107.105609275, 2953688.0056545623 4482249.819522634, 2953652.7396398783 4482451.948394656, 2953508.157885235 4482719.850011487, 2953380.3074500635 4482980.620107818, 2953274.876760334 4483036.999141604, 2953247.2806585617 4483147.056700904, 2953548.199506074 4483213.738452937, 2953564.57460317 4483386.701465927, 2953653.0402025096 4483473.596961997, 2953547.0974431187 4483555.160123937, 2953595.0984075516 4483624.657979831, 2953546.4740539677 4483650.007664494, 2953512.811039958 4483759.721692011, 2953675.905225914 4483776.099107347, 2953815.076853305 4483709.3158070035, 2953943.2501149997 4483711.569439027, 2954029.3223452866 4483773.397531945, 2954140.341273453 4483788.123225957, 2954209.147850711 4483885.89843753, 2954218.6545352265 4483982.988652036, 2954105.8544952087 4484176.87780422, 2953776.2597468607 4484392.566362049, 2953639.069606412 4484540.812814515, 2953563.5393319093 4484548.582162134, 2953467.3258960135 4484627.21388248, 2953430.390088968 4484765.3562737405, 2953411.5770950243 4484992.2984269895, 2953551.639278345 4485195.20798111, 2953645.7933036573 4485391.793469571, 2953624.1861904897 4485431.875408452, 2953667.578528002 4485443.775419716, 2953759.072017487 4485309.642072208, 2953860.9961432554 4485243.843017682, 2953940.1443012096 4485295.054246306, 2953914.641005866 4485325.685904093, 2953914.128936209 4485618.4271339215, 2954007.9156072065 4485634.933445938, 2954228.283671178 4485566.122316323, 2954305.88448821 4485587.8506243825, 2954334.983403109 4485638.083508424, 2954390.709940195 4485694.420785315, 2954572.3499533236 4485557.974212378, 2954629.7128869332 4485542.336030558, 2954697.1836303025 4485599.876814187, 2954747.6670193747 4485613.2050406, 2954812.3325115778 4485701.658971246, 2954876.998003777 4485661.3099982925, 2954960.4096982293 4485747.9022766985, 2955009.3791422285 4485966.115180336, 2954923.4850231335 4486170.317613136, 2954663.9324983954 4486437.41786027, 2954498.411547538 4486326.681813713, 2954227.949712705 4486171.689710088, 2954081.831749089 4486427.812942684, 2954060.2691637278 4486691.92336975, 2954108.81559366 4486908.6996582635, 2954234.8960489333 4487058.801864278, 2954042.769739773 4487196.87818303, 2954090.8041000515 4487437.035321005, 2953868.666056175 4487707.206405647, 2954012.746873107 4487809.261019535, 2953904.6890433915 4488055.425641928, 2953724.5741072856 4488109.451278895, 2953748.5857214555 4488349.6012558155, 2953820.6316958964 4488751.85670552, 2954132.8272078224 4488835.911609307, 2954288.919397816 4488739.8409144655, 2954457.03409281 4488739.8409144655, 2954511.0685736425 4488919.953180563, 2954354.965251699 4489298.197584726, 2954186.861688655 4489514.327349383, 2953790.60882923 4489616.3995090835, 2953646.5280122906 4489760.489887297, 2953622.5052661784 4489958.603376877, 2953826.631816447 4490120.710469432, 2953790.60882923 4490498.942062981, 2953634.5166392364 4490540.976417482, 2953568.4707853533 4490895.200620383, 2953772.5973356143 4491165.362555478, 2953772.5973356143 4491369.497917984, 2953604.49377257 4491519.579791255, 2953604.49377257 4491639.658040002, 2953748.5857214555 4491789.757780794, 2953748.5857214555 4492005.896769542, 2953976.7238858826 4491927.840229303, 2954192.861809209 4491879.81865456, 2954216.884555325 4491747.732438903, 2954433.011346698 4491765.74728154, 2954688.1778834946 4491507.574843474, 2954946.3389145955 4491393.507511742, 2955114.4424776398 4491153.358012389, 2955090.4308634773 4490745.099650577, 2954904.3046748675 4490727.086557712, 2954946.3389145955 4490456.921883319, 2955210.500066243 4490378.876848783, 2955288.546161242 4490438.909284413, 2955540.707071785 4490402.884179238, 2955678.7989001125 4490312.835963078, 2955912.937185101 4490420.8967163935, 2956083.868263215 4490575.559289709, 2956190.2896964103 4490509.517167989, 2956400.3273116387 4490530.737443931, 2956448.3950677663 4490628.267223574, 2956431.0626230463 4490721.525756899, 2956325.253447052 4490916.925938368, 2956412.950941898 4490906.196343079, 2956702.1923748218 4490779.248973589, 2956852.161992822 4490757.972167429, 2956877.832267396 4490799.825465035, 2956892.6488916203 4490852.128314231, 2956883.698804565 4490915.413148809, 2956734.4193674102 4491008.268014953, 2956623.244591955 4491048.063208763, 2956597.195831105 4491443.838185921, 2956711.008878492 4491450.954259504, 2957044.266038079 4491372.20144593, 2957299.811061144 4491387.498104189, 2957605.9953205734 4491621.643413559, 2957690.0526680723 4491867.799286589, 2957599.995200023 4491999.887011722, 2957672.041174464 4492077.930078376, 2957599.995200023 4491999.887011722, 2958200.37460972 4491861.80361633 ))";
    let poly = Polygon::from_wkt(wkt_data);
    let ply_coords = poly.shell().coordinates();
    let hull = convex_hull(ply_coords);
    let shull = convex_hull(ply_coords);

    let phull = Polygon::from_vec(&hull);
    let pshull = Polygon::from_vec(&shull);
    assert_eq!(round(phull.area(), 2), 110190309.57);
    assert_eq!(round(pshull.area(), 2), 110190309.57);

    let arr4 = pts![[5.10, 8.59], [5.10, 8.59], [5.10, 8.59], [5.10, 8.59], [5.01, 8.74], [5.01, 8.74], [5.01, 8.74], [5.01, 8.74]];
    let hull = convex_hull(&arr4);
    let phull = Polygon::from_vec(&hull);
    assert_eq!(round(phull.area(), 2), 0.0);

    let arr5 = pts![[5.10, 8.59], [5.10, 8.59]];
    let hull = convex_hull(&arr5);
    assert_eq!(&arr5, &hull);
    let phull = Polygon::from_vec(&hull);
    assert_eq!(round(phull.area(), 2), 0.0)
}


#[test]
fn test_segments() {
    let wkt = "POLYGON (( -0.3604422185430426 -10, -0.3604422185430426 0.5291138245033155, 10 0.5291138245033155, 10 -10, -0.3604422185430426 -10 ))";
    let ply = Polygon::from_wkt(wkt);
    let a: Point = (0, 0).into();
    let b: Point = (-3, 4).into();
    let c: Point = (1.5, -2.).into();
    let d: Point = (-1.5, 2.).into();
    let e: Point = (0.5, 3.).into();

    //f := &Point{-2, -2}
    let gk: Point = [-1.5, -2.5].into();
    let h: Point = [0.484154648492778, -0.645539531323704].into();
    let i: Point = [0.925118053504632, -1.233490738006176].into();
    let k: Point = [2, 2].into();
    let n: Point = [1, 5].into();
    n.bbox();

    let seg_ab = Segment::new(a, b);
    let ln_ab: LineString = vec![a, b].into();
    let seg_de = Segment::new(d, e);
    let seg_cd = Segment::new(c, d);
    let seg_gkh = Segment::new(gk, h);
    let seg_hi = Segment::new(h, i);
    let seg_ak = Segment::new(a, k);
    let seg_kn = Segment::new(k, n);

    assert!(seg_ab.geom_type().is_segment());
    assert!(!seg_ab.geom_type().is_line_string());
    assert!(!seg_ab.geom_type().is_polygon());
    assert!(seg_ab.is_simple());
    assert!(!seg_ab.geom_type().is_line_string());
    let mbox = MBR::new(0., 0., -3., 4.);
    let seg_ab_box = seg_ab.bbox();
    let ab_linear = seg_ab.as_linear();
    assert!(seg_ab_box.equals(&mbox));

    assert_eq!(ab_linear.len(), 1);
    assert_eq!([ab_linear[0].wkt()], [ln_ab.wkt()]);
    assert_eq!(seg_ab.wkt_string(), ln_ab.wkt());
    assert!(!seg_ab.intersects(&k));
    assert!(!seg_ab.intersects(&seg_kn));
    assert!(!seg_ab.intersects(&seg_kn));
    assert!(seg_ab.intersects(&seg_ak));
    assert!(seg_ab.intersects(&ply));
    assert_eq!(ply.intersects(&seg_ab), true);

    assert!(!seg_kn.intersects(&ply));
    assert!(!ply.intersects(&seg_kn));

    assert_eq!(seg_ab.intersection(&seg_ak), [a]);
    assert_eq!(seg_ab.distance(&seg_ak), 0.0);
    assert!(feq(seg_ab.distance(&seg_kn), 2.8));

    let pts = seg_ab.seg_seg_intersection(&seg_de);
    assert_eq!(pts[0].pt, Point { x: -1.5, y: 2. });

    let pts = seg_ab.seg_seg_intersection(&seg_cd);
    assert!(pts.len() > 0);
    assert_eq!(pts[0].pt, [-1.5, 2.].into());
    assert_eq!(pts[1].pt, [0.0, 0.0].into());

    let pts = seg_gkh.seg_seg_intersection(&seg_cd);
    assert_eq!(pts.len(), 1); //at h

    let pts = seg_hi.seg_seg_intersection(&seg_cd);
    assert_eq!(pts.len(), 2);//at h, i

    let pts = seg_hi.seg_seg_intersection(&seg_ab);
    let ok = pts.len() > 0;
    assert_eq!(seg_hi.seg_seg_intersects(&seg_ab), ok);
    assert!(!ok);
    assert_eq!(pts.len(), 0); //empty

    let pts = seg_ak.seg_seg_intersection(&seg_kn);
    let ok = pts.len() > 0;
    assert!(seg_ak.seg_seg_intersects(&seg_kn), ok);
    assert!(ok);
    assert_eq!(pts.len(), 1);      //at k
    assert!(pts[0].pt.equals(&k)); //k
}

fn test_geom_distance<T:Geometry>(a:&T, b:&T) -> f64{
    a.distance(b)
}
#[test]
fn test_distance() {
    let poly_a:Polygon = "POLYGON (( 450 600, 450 725, 575 725, 575 600, 450 600 ))".into();
    let poly_b:Polygon = "POLYGON (( 675 475, 675 550, 825 550, 825 475, 675 475 ))".into();
    let poly_c:Polygon = "POLYGON (( 575 650, 575 775, 650 775, 650 650, 575 650 ))".into();
    assert_eq!(round(poly_a.distance(&poly_b), 1), 111.8);
    assert_eq!(round(test_geom_distance(&poly_a, &poly_b), 1), 111.8);
    assert_eq!(round(test_geom_distance(&poly_a, &poly_c), 1), 0.);

    let wkt_a = "LINESTRING ( 201.4094393973535 156.03490222759163, 204.4094393973535 157.03490222759163, 205.4094393973535 156.03490222759163, 206.4094393973535 153.03490222759163, 206.4094393973535 152.03490222759163, 208.4094393973535 153.03490222759163, 211.4094393973535 153.03490222759163, 212.4094393973535 152.03490222759163, 215.4094393973535 151.03490222759163, 216.4094393973535 151.03490222759163, 217.4094393973535 151.03490222759163, 218.4094393973535 151.03490222759163, 221.4094393973535 152.03490222759163, 223.4094393973535 151.03490222759163, 224.4094393973535 151.03490222759163, 224.4094393973535 154.03490222759163, 224.4094393973535 157.03490222759163, 225.4094393973535 158.03490222759163, 225.4094393973535 161.03490222759163, 226.4094393973535 161.03490222759163, 228.4094393973535 163.03490222759163, 228.4094393973535 165.03490222759163, 229.4094393973535 165.03490222759163, 230.4094393973535 168.03490222759163, 229.4094393973535 165.03490222759163, 229.4094393973535 164.03490222759163, 230.4094393973535 164.03490222759163, 230.4094393973535 165.03490222759163, 232.4094393973535 167.03490222759163, 230.4094393973535 169.03490222759163, 227.4094393973535 170.03490222759163, 226.4094393973535 172.03490222759163, 226.4094393973535 173.03490222759163, 227.4094393973535 172.03490222759163, 229.4094393973535 170.03490222759163, 232.4094393973535 170.03490222759163, 233.4094393973535 170.03490222759163, 234.4094393973535 172.03490222759163, 235.4094393973535 174.03490222759163, 235.4094393973535 176.03490222759163, 236.4094393973535 178.03490222759163, 235.4094393973535 180.03490222759163, 235.4094393973535 181.03490222759163, 235.4094393973535 182.03490222759163, 234.4094393973535 182.03490222759163, 233.4094393973535 180.03490222759163, 234.4094393973535 179.03490222759163, 234.4094393973535 176.03490222759163, 233.4094393973535 176.03490222759163, 232.4094393973535 174.03490222759163, 230.4094393973535 174.03490222759163, 230.4094393973535 176.03490222759163, 232.4094393973535 176.03490222759163, 230.4094393973535 176.03490222759163, 232.4094393973535 178.03490222759163, 232.4094393973535 180.03490222759163, 229.4094393973535 182.03490222759163, 233.4094393973535 181.03490222759163, 233.4094393973535 182.03490222759163, 234.4094393973535 183.03490222759163, 233.4094393973535 184.03490222759163, 230.4094393973535 185.03490222759163, 229.4094393973535 184.03490222759163, 226.4094393973535 186.03490222759163, 226.4094393973535 189.03490222759163, 226.4094393973535 191.03490222759163, 223.4094393973535 193.03490222759163, 222.4094393973535 193.03490222759163, 222.4094393973535 192.03490222759163, 221.4094393973535 191.03490222759163, 219.4094393973535 191.03490222759163, 218.4094393973535 191.03490222759163, 219.4094393973535 191.03490222759163, 221.4094393973535 193.03490222759163, 222.4094393973535 193.03490222759163, 219.4094393973535 194.03490222759163, 217.4094393973535 193.03490222759163, 216.4094393973535 193.03490222759163, 216.4094393973535 194.03490222759163, 216.4094393973535 196.03490222759163, 216.4094393973535 197.03490222759163, 218.4094393973535 197.03490222759163, 218.4094393973535 200.03490222759163, 218.4094393973535 201.03490222759163, 218.4094393973535 202.03490222759163, 218.4094393973535 204.03490222759166, 218.4094393973535 205.03490222759166, 222.4094393973535 208.0349022275916, 221.4094393973535 209.0349022275916, 219.4094393973535 213.0349022275916, 221.4094393973535 214.0349022275916, 222.4094393973535 214.0349022275916, 222.4094393973535 215.0349022275916, 219.4094393973535 214.0349022275916, 219.4094393973535 215.0349022275916, 218.4094393973535 215.0349022275916, 219.4094393973535 217.0349022275916, 221.4094393973535 218.0349022275916, 221.4094393973535 220.0349022275916, 222.4094393973535 224.0349022275916, 221.4094393973535 228.0349022275916, 223.4094393973535 228.0349022275916, 221.4094393973535 233.0349022275916, 219.4094393973535 234.0349022275916, 218.4094393973535 236.0349022275916, 217.4094393973535 239.0349022275916, 217.4094393973535 242.0349022275916, 214.4094393973535 248.0349022275916, 213.4094393973535 249.0349022275916, 212.4094393973535 249.0349022275916, 212.4094393973535 250.0349022275916, 213.4094393973535 251.0349022275916, 213.4094393973535 250.0349022275916, 213.4094393973535 252.0349022275916, 214.4094393973535 253.0349022275916, 213.4094393973535 256.0349022275916, 212.4094393973535 256.0349022275916, 213.4094393973535 255.0349022275916, 211.4094393973535 256.0349022275916, 211.4094393973535 255.0349022275916, 208.4094393973535 256.0349022275916, 206.4094393973535 253.0349022275916, 204.4094393973535 255.0349022275916, 205.4094393973535 253.0349022275916, 204.4094393973535 253.0349022275916, 203.4094393973535 253.0349022275916, 204.4094393973535 255.0349022275916, 203.4094393973535 255.0349022275916, 202.4094393973535 256.0349022275916, 201.4094393973535 257.0349022275916, 202.4094393973535 256.0349022275916, 202.4094393973535 255.0349022275916, 202.4094393973535 253.0349022275916, 201.4094393973535 253.0349022275916, 201.4094393973535 251.0349022275916, 201.4094393973535 253.0349022275916, 201.4094393973535 255.0349022275916, 200.4094393973535 257.0349022275916, 197.4094393973535 256.0349022275916, 199.4094393973535 255.0349022275916, 197.4094393973535 255.0349022275916, 197.4094393973535 256.0349022275916, 196.4094393973535 256.0349022275916, 195.4094393973535 256.0349022275916, 191.4094393973535 256.0349022275916, 189.4094393973535 257.0349022275916, 188.4094393973535 257.0349022275916, 186.4094393973535 257.0349022275916, 188.4094393973535 258.0349022275916, 189.4094393973535 259.0349022275916, 188.4094393973535 259.0349022275916, 188.4094393973535 260.0349022275916, 184.4094393973535 260.0349022275916, 184.4094393973535 262.0349022275916, 183.4094393973535 262.0349022275916, 182.4094393973535 262.0349022275916, 181.4094393973535 261.0349022275916, 181.4094393973535 262.0349022275916, 180.4094393973535 262.0349022275916, 181.4094393973535 263.0349022275916, 179.4094393973535 264.0349022275916, 178.4094393973535 266.0349022275916, 174.4094393973535 267.0349022275916, 173.4094393973535 266.0349022275916, 174.4094393973535 264.0349022275916, 175.4094393973535 263.0349022275916, 172.4094393973535 264.0349022275916, 170.4094393973535 263.0349022275916, 170.4094393973535 264.0349022275916, 171.4094393973535 264.0349022275916, 172.4094393973535 266.0349022275916, 172.4094393973535 267.0349022275916, 170.4094393973535 269.0349022275916, 169.4094393973535 269.0349022275916, 168.4094393973535 269.0349022275916, 167.4094393973535 269.0349022275916, 166.4094393973535 270.0349022275916, 166.4094393973535 272.0349022275916, 166.4094393973535 271.0349022275916, 163.4094393973535 271.0349022275916, 162.4094393973535 274.0349022275916, 161.4094393973535 274.0349022275916, 161.4094393973535 272.0349022275916, 159.4094393973535 272.0349022275916, 159.4094393973535 274.0349022275916, 158.4094393973535 274.0349022275916, 156.4094393973535 272.0349022275916, 155.4094393973535 274.0349022275916, 153.4094393973535 272.0349022275916, 153.4094393973535 274.0349022275916, 152.4094393973535 274.0349022275916, 152.4094393973535 273.0349022275916, 152.4094393973535 275.0349022275916, 151.4094393973535 275.0349022275916, 150.4094393973535 274.0349022275916, 150.4094393973535 275.0349022275916, 149.4094393973535 275.0349022275916, 148.4094393973535 274.0349022275916, 149.4094393973535 272.0349022275916, 148.4094393973535 271.0349022275916, 148.4094393973535 272.0349022275916, 147.4094393973535 272.0349022275916, 146.4094393973535 272.0349022275916, 146.4094393973535 274.0349022275916, 145.4094393973535 274.0349022275916, 144.4094393973535 274.0349022275916, 144.4094393973535 272.0349022275916, 141.4094393973535 274.0349022275916, 142.4094393973535 274.0349022275916, 140.4094393973535 274.0349022275916, 140.4094393973535 273.0349022275916, 139.4094393973535 274.0349022275916, 139.4094393973535 273.0349022275916, 141.4094393973535 271.0349022275916, 144.4094393973535 271.0349022275916, 146.4094393973535 269.0349022275916, 140.4094393973535 271.0349022275916, 139.4094393973535 271.0349022275916, 140.4094393973535 270.0349022275916, 141.4094393973535 269.0349022275916, 148.4094393973535 268.0349022275916, 148.4094393973535 267.0349022275916, 147.4094393973535 266.0349022275916, 147.4094393973535 264.0349022275916, 147.4094393973535 266.0349022275916, 146.4094393973535 268.0349022275916, 138.4094393973535 268.0349022275916, 138.4094393973535 269.0349022275916, 136.4094393973535 269.0349022275916, 135.4094393973535 269.0349022275916, 134.4094393973535 269.0349022275916, 134.4094393973535 268.0349022275916, 135.4094393973535 269.0349022275916, 135.4094393973535 268.0349022275916, 135.4094393973535 267.0349022275916, 137.4094393973535 267.0349022275916, 138.4094393973535 266.0349022275916, 137.4094393973535 266.0349022275916, 137.4094393973535 264.0349022275916, 139.4094393973535 263.0349022275916, 139.4094393973535 264.0349022275916, 139.4094393973535 263.0349022275916, 141.4094393973535 263.0349022275916, 140.4094393973535 263.0349022275916, 142.4094393973535 261.0349022275916, 145.4094393973535 261.0349022275916, 146.4094393973535 261.0349022275916, 144.4094393973535 261.0349022275916, 141.4094393973535 262.0349022275916, 140.4094393973535 262.0349022275916, 139.4094393973535 262.0349022275916, 134.4094393973535 264.0349022275916, 134.4094393973535 263.0349022275916, 133.4094393973535 263.0349022275916, 133.4094393973535 262.0349022275916, 134.4094393973535 261.0349022275916, 133.4094393973535 260.0349022275916, 131.4094393973535 261.0349022275916, 130.4094393973535 262.0349022275916, 130.4094393973535 260.0349022275916, 129.4094393973535 260.0349022275916, 129.4094393973535 258.0349022275916, 131.4094393973535 258.0349022275916, 133.4094393973535 258.0349022275916, 131.4094393973535 257.0349022275916, 133.4094393973535 256.0349022275916, 138.4094393973535 253.0349022275916, 139.4094393973535 252.0349022275916, 139.4094393973535 253.0349022275916, 140.4094393973535 251.0349022275916, 141.4094393973535 251.0349022275916, 144.4094393973535 251.0349022275916, 140.4094393973535 250.0349022275916, 139.4094393973535 250.0349022275916, 139.4094393973535 251.0349022275916, 138.4094393973535 250.0349022275916, 135.4094393973535 251.0349022275916, 134.4094393973535 250.0349022275916, 133.4094393973535 250.0349022275916, 131.4094393973535 250.0349022275916, 133.4094393973535 251.0349022275916, 130.4094393973535 250.0349022275916, 131.4094393973535 251.0349022275916, 129.4094393973535 251.0349022275916, 128.4094393973535 250.0349022275916, 128.4094393973535 249.0349022275916, 129.4094393973535 249.0349022275916, 128.4094393973535 248.0349022275916, 129.4094393973535 248.0349022275916, 129.4094393973535 249.0349022275916, 130.4094393973535 249.0349022275916, 130.4094393973535 247.0349022275916, 131.4094393973535 247.0349022275916, 133.4094393973535 246.0349022275916, 135.4094393973535 246.0349022275916, 135.4094393973535 247.0349022275916, 137.4094393973535 248.0349022275916, 138.4094393973535 246.0349022275916, 137.4094393973535 245.0349022275916, 138.4094393973535 244.0349022275916, 138.4094393973535 246.0349022275916, 139.4094393973535 248.0349022275916, 141.4094393973535 248.0349022275916, 144.4094393973535 248.0349022275916, 144.4094393973535 247.0349022275916, 140.4094393973535 247.0349022275916, 140.4094393973535 245.0349022275916, 141.4094393973535 246.0349022275916, 141.4094393973535 245.0349022275916, 142.4094393973535 242.0349022275916, 140.4094393973535 241.0349022275916, 145.4094393973535 240.0349022275916, 146.4094393973535 239.0349022275916, 147.4094393973535 240.0349022275916, 147.4094393973535 239.0349022275916, 146.4094393973535 239.0349022275916, 147.4094393973535 237.0349022275916, 148.4094393973535 237.0349022275916, 150.4094393973535 238.0349022275916, 150.4094393973535 237.0349022275916, 153.4094393973535 238.0349022275916, 159.4094393973535 236.0349022275916, 159.4094393973535 237.0349022275916, 160.4094393973535 237.0349022275916, 161.4094393973535 236.0349022275916, 163.4094393973535 236.0349022275916, 166.4094393973535 236.0349022275916, 162.4094393973535 235.0349022275916, 161.4094393973535 235.0349022275916, 161.4094393973535 234.0349022275916, 160.4094393973535 233.0349022275916, 159.4094393973535 233.0349022275916, 159.4094393973535 234.0349022275916, 156.4094393973535 237.0349022275916, 155.4094393973535 236.0349022275916, 153.4094393973535 238.0349022275916, 152.4094393973535 237.0349022275916, 153.4094393973535 236.0349022275916, 151.4094393973535 236.0349022275916, 149.4094393973535 236.0349022275916, 149.4094393973535 235.0349022275916, 148.4094393973535 234.0349022275916, 149.4094393973535 236.0349022275916, 146.4094393973535 236.0349022275916, 146.4094393973535 237.0349022275916, 141.4094393973535 236.0349022275916, 140.4094393973535 236.0349022275916, 144.4094393973535 236.0349022275916, 147.4094393973535 233.0349022275916, 148.4094393973535 231.0349022275916, 150.4094393973535 231.0349022275916, 150.4094393973535 229.0349022275916, 151.4094393973535 228.0349022275916, 151.4094393973535 226.0349022275916, 153.4094393973535 225.0349022275916, 152.4094393973535 225.0349022275916, 150.4094393973535 225.0349022275916, 151.4094393973535 224.0349022275916, 155.4094393973535 219.0349022275916, 158.4094393973535 219.0349022275916, 159.4094393973535 219.0349022275916, 161.4094393973535 219.0349022275916, 159.4094393973535 219.0349022275916, 161.4094393973535 219.0349022275916, 162.4094393973535 219.0349022275916, 162.4094393973535 218.0349022275916, 163.4094393973535 217.0349022275916, 162.4094393973535 217.0349022275916, 161.4094393973535 217.0349022275916, 161.4094393973535 216.0349022275916, 162.4094393973535 215.0349022275916, 162.4094393973535 214.0349022275916, 160.4094393973535 214.0349022275916, 158.4094393973535 215.0349022275916, 151.4094393973535 215.0349022275916, 150.4094393973535 215.0349022275916, 150.4094393973535 213.0349022275916, 149.4094393973535 215.0349022275916, 149.4094393973535 214.0349022275916, 149.4094393973535 213.0349022275916, 149.4094393973535 212.0349022275916, 150.4094393973535 212.0349022275916, 149.4094393973535 211.0349022275916, 149.4094393973535 212.0349022275916, 149.4094393973535 211.0349022275916, 148.4094393973535 212.0349022275916, 147.4094393973535 212.0349022275916, 146.4094393973535 211.0349022275916, 145.4094393973535 211.0349022275916, 145.4094393973535 209.0349022275916, 147.4094393973535 208.0349022275916, 145.4094393973535 208.0349022275916, 144.4094393973535 208.0349022275916, 144.4094393973535 209.0349022275916, 141.4094393973535 208.0349022275916, 140.4094393973535 207.03490222759166, 139.4094393973535 208.0349022275916, 139.4094393973535 207.03490222759166, 138.4094393973535 207.03490222759166, 139.4094393973535 205.03490222759166, 141.4094393973535 206.03490222759166, 140.4094393973535 205.03490222759166, 140.4094393973535 204.03490222759166, 139.4094393973535 203.03490222759163, 138.4094393973535 203.03490222759163, 140.4094393973535 203.03490222759163, 140.4094393973535 202.03490222759163, 144.4094393973535 203.03490222759163, 141.4094393973535 200.03490222759163, 146.4094393973535 200.03490222759163, 146.4094393973535 198.03490222759163, 146.4094393973535 196.03490222759163, 148.4094393973535 195.03490222759163, 150.4094393973535 196.03490222759163, 151.4094393973535 195.03490222759163, 150.4094393973535 195.03490222759163, 151.4094393973535 194.03490222759163, 150.4094393973535 194.03490222759163, 151.4094393973535 193.03490222759163, 151.4094393973535 192.03490222759163, 148.4094393973535 192.03490222759163, 147.4094393973535 192.03490222759163, 146.4094393973535 192.03490222759163, 146.4094393973535 190.03490222759163, 148.4094393973535 191.03490222759163, 148.4094393973535 189.03490222759163, 148.4094393973535 190.03490222759163, 148.4094393973535 189.03490222759163, 147.4094393973535 186.03490222759163, 147.4094393973535 185.03490222759163, 148.4094393973535 185.03490222759163, 147.4094393973535 185.03490222759163, 148.4094393973535 184.03490222759163, 147.4094393973535 184.03490222759163, 147.4094393973535 185.03490222759163, 146.4094393973535 184.03490222759163, 147.4094393973535 183.03490222759163, 146.4094393973535 183.03490222759163, 147.4094393973535 182.03490222759163, 146.4094393973535 182.03490222759163, 147.4094393973535 181.03490222759163, 145.4094393973535 180.03490222759163, 145.4094393973535 181.03490222759163, 145.4094393973535 182.03490222759163, 144.4094393973535 182.03490222759163, 144.4094393973535 183.03490222759163, 144.4094393973535 184.03490222759163, 142.4094393973535 184.03490222759163, 144.4094393973535 180.03490222759163, 142.4094393973535 179.03490222759163, 144.4094393973535 179.03490222759163, 146.4094393973535 176.03490222759163, 146.4094393973535 179.03490222759163, 147.4094393973535 180.03490222759163, 147.4094393973535 181.03490222759163, 146.4094393973535 180.03490222759163, 148.4094393973535 181.03490222759163, 148.4094393973535 179.03490222759163, 148.4094393973535 180.03490222759163, 148.4094393973535 179.03490222759163, 148.4094393973535 178.03490222759163, 148.4094393973535 176.03490222759163, 150.4094393973535 178.03490222759163, 155.4094393973535 178.03490222759163, 156.4094393973535 180.03490222759163, 158.4094393973535 179.03490222759163, 159.4094393973535 179.03490222759163, 159.4094393973535 180.03490222759163, 160.4094393973535 181.03490222759163, 160.4094393973535 182.03490222759163, 161.4094393973535 183.03490222759163, 163.4094393973535 180.03490222759163, 166.4094393973535 180.03490222759163, 168.4094393973535 182.03490222759163, 169.4094393973535 181.03490222759163, 170.4094393973535 182.03490222759163, 172.4094393973535 183.03490222759163, 173.4094393973535 183.03490222759163, 172.4094393973535 182.03490222759163, 173.4094393973535 181.03490222759163, 174.4094393973535 181.03490222759163, 173.4094393973535 180.03490222759163, 174.4094393973535 180.03490222759163, 173.4094393973535 179.03490222759163, 172.4094393973535 180.03490222759163, 171.4094393973535 179.03490222759163, 173.4094393973535 178.03490222759163, 173.4094393973535 176.03490222759163, 175.4094393973535 176.03490222759163, 174.4094393973535 175.03490222759163, 175.4094393973535 174.03490222759163, 175.4094393973535 175.03490222759163, 179.4094393973535 175.03490222759163, 180.4094393973535 173.03490222759163, 180.4094393973535 172.03490222759163, 182.4094393973535 170.03490222759163, 183.4094393973535 170.03490222759163, 182.4094393973535 170.03490222759163, 180.4094393973535 170.03490222759163, 179.4094393973535 170.03490222759163, 178.4094393973535 170.03490222759163, 175.4094393973535 172.03490222759163, 175.4094393973535 170.03490222759163, 178.4094393973535 170.03490222759163, 175.4094393973535 170.03490222759163, 173.4094393973535 170.03490222759163, 172.4094393973535 170.03490222759163, 169.4094393973535 168.03490222759163, 170.4094393973535 167.03490222759163, 169.4094393973535 167.03490222759163, 170.4094393973535 167.03490222759163, 170.4094393973535 165.03490222759163, 172.4094393973535 164.03490222759163, 177.4094393973535 165.03490222759163, 175.4094393973535 164.03490222759163, 174.4094393973535 164.03490222759163, 175.4094393973535 164.03490222759163, 178.4094393973535 165.03490222759163, 174.4094393973535 162.03490222759163, 175.4094393973535 162.03490222759163, 179.4094393973535 162.03490222759163, 178.4094393973535 161.03490222759163, 179.4094393973535 161.03490222759163, 180.4094393973535 161.03490222759163, 179.4094393973535 161.03490222759163, 178.4094393973535 160.03490222759163, 178.4094393973535 161.03490222759163, 177.4094393973535 160.03490222759163, 177.4094393973535 158.03490222759163, 179.4094393973535 158.03490222759163, 178.4094393973535 158.03490222759163, 177.4094393973535 156.03490222759163, 178.4094393973535 156.03490222759163, 178.4094393973535 154.03490222759163, 179.4094393973535 156.03490222759163, 179.4094393973535 154.03490222759163, 180.4094393973535 154.03490222759163, 180.4094393973535 153.03490222759163, 181.4094393973535 152.03490222759163, 183.4094393973535 152.03490222759163, 183.4094393973535 153.03490222759163, 184.4094393973535 152.03490222759163, 186.4094393973535 152.03490222759163, 186.4094393973535 150.03490222759163, 186.4094393973535 149.03490222759163, 188.4094393973535 150.03490222759163, 188.4094393973535 151.03490222759163, 189.4094393973535 151.03490222759163, 189.4094393973535 152.03490222759163, 190.4094393973535 152.03490222759163, 189.4094393973535 152.03490222759163, 190.4094393973535 152.03490222759163, 190.4094393973535 151.03490222759163, 189.4094393973535 151.03490222759163, 189.4094393973535 149.03490222759163, 190.4094393973535 149.03490222759163, 190.4094393973535 152.03490222759163, 191.4094393973535 152.03490222759163, 192.4094393973535 153.03490222759163, 192.4094393973535 154.03490222759163, 193.4094393973535 153.03490222759163, 192.4094393973535 150.03490222759163, 192.4094393973535 152.03490222759163, 192.4094393973535 151.03490222759163, 192.4094393973535 150.03490222759163, 191.4094393973535 150.03490222759163, 191.4094393973535 149.03490222759163, 192.4094393973535 149.03490222759163, 193.4094393973535 148.03490222759163, 194.4094393973535 149.03490222759163, 194.4094393973535 151.03490222759163, 195.4094393973535 153.03490222759163, 195.4094393973535 154.03490222759163, 193.4094393973535 157.03490222759163, 194.4094393973535 157.03490222759163, 193.4094393973535 157.03490222759163, 192.4094393973535 159.03490222759163, 194.4094393973535 157.03490222759163, 196.4094393973535 156.03490222759163, 196.4094393973535 153.03490222759163, 195.4094393973535 150.03490222759163, 196.4094393973535 150.03490222759163, 195.4094393973535 149.03490222759163, 196.4094393973535 149.03490222759163, 199.4094393973535 148.03490222759163, 199.4094393973535 149.03490222759163, 201.4094393973535 149.03490222759163, 199.4094393973535 148.03490222759163, 199.4094393973535 147.03490222759163, 199.4094393973535 146.03490222759163, 197.4094393973535 146.03490222759163, 201.4094393973535 146.03490222759163, 202.4094393973535 147.03490222759163, 203.4094393973535 148.03490222759163, 207.4094393973535 150.03490222759163, 207.4094393973535 151.03490222759163, 203.4094393973535 153.03490222759163 )";
    let wkt_b = "LINESTRING ( 92.08384332442225 204.3026301378301, 95.08384332442225 205.3026301378301, 96.08384332442225 204.3026301378301, 97.08384332442225 201.3026301378301, 97.08384332442225 200.3026301378301, 99.08384332442225 201.3026301378301, 102.08384332442225 201.3026301378301, 103.08384332442225 200.3026301378301, 106.08384332442225 199.3026301378301, 107.08384332442225 199.3026301378301, 108.08384332442225 199.3026301378301, 109.08384332442225 199.3026301378301, 112.08384332442225 200.3026301378301, 114.08384332442225 199.3026301378301, 115.08384332442225 199.3026301378301, 115.08384332442225 202.3026301378301, 115.08384332442225 205.3026301378301, 116.08384332442225 206.3026301378301, 116.08384332442225 209.3026301378301, 117.08384332442225 209.3026301378301, 119.08384332442225 211.3026301378301, 119.08384332442225 213.3026301378301, 120.08384332442225 213.3026301378301, 121.08384332442225 216.3026301378301, 120.08384332442225 213.3026301378301, 120.08384332442225 212.3026301378301, 121.08384332442225 212.3026301378301, 121.08384332442225 213.3026301378301, 123.08384332442225 215.3026301378301, 121.08384332442225 217.3026301378301, 118.08384332442225 218.3026301378301, 117.08384332442225 220.3026301378301, 117.08384332442225 221.3026301378301, 118.08384332442225 220.3026301378301, 120.08384332442225 218.3026301378301, 123.08384332442225 218.3026301378301, 124.08384332442225 218.3026301378301, 125.08384332442225 220.3026301378301, 126.08384332442225 222.3026301378301, 126.08384332442225 224.3026301378301, 127.08384332442225 226.3026301378301, 126.08384332442225 228.3026301378301, 126.08384332442225 229.3026301378301, 126.08384332442225 230.3026301378301, 125.08384332442225 230.3026301378301, 124.08384332442225 228.3026301378301, 125.08384332442225 227.3026301378301, 125.08384332442225 224.3026301378301, 124.08384332442225 224.3026301378301, 123.08384332442225 222.3026301378301, 121.08384332442225 222.3026301378301, 121.08384332442225 224.3026301378301, 123.08384332442225 224.3026301378301, 121.08384332442225 224.3026301378301, 123.08384332442225 226.3026301378301, 123.08384332442225 228.3026301378301, 120.08384332442225 230.3026301378301, 124.08384332442225 229.3026301378301, 124.08384332442225 230.3026301378301, 125.08384332442225 231.3026301378301, 124.08384332442225 232.3026301378301, 121.08384332442225 233.3026301378301, 120.08384332442225 232.3026301378301, 117.08384332442225 234.3026301378301, 117.08384332442225 237.3026301378301, 117.08384332442225 239.3026301378301, 114.08384332442225 241.3026301378301, 113.08384332442225 241.3026301378301, 113.08384332442225 240.3026301378301, 112.08384332442225 239.3026301378301, 110.08384332442225 239.3026301378301, 109.08384332442225 239.3026301378301, 110.08384332442225 239.3026301378301, 112.08384332442225 241.3026301378301, 113.08384332442225 241.3026301378301, 110.08384332442225 242.3026301378301, 108.08384332442225 241.3026301378301, 107.08384332442225 241.3026301378301, 107.08384332442225 242.3026301378301, 107.08384332442225 244.3026301378301, 107.08384332442225 245.3026301378301, 109.08384332442225 245.3026301378301, 109.08384332442225 248.3026301378301, 109.08384332442225 249.3026301378301, 109.08384332442225 250.3026301378301, 109.08384332442225 252.3026301378301, 109.08384332442225 253.3026301378301, 113.08384332442225 256.3026301378301, 112.08384332442225 257.3026301378301, 110.08384332442225 261.3026301378301, 112.08384332442225 262.3026301378301, 113.08384332442225 262.3026301378301, 113.08384332442225 263.3026301378301, 110.08384332442225 262.3026301378301, 110.08384332442225 263.3026301378301, 109.08384332442225 263.3026301378301, 110.08384332442225 265.3026301378301, 112.08384332442225 266.3026301378301, 112.08384332442225 268.3026301378301, 113.08384332442225 272.3026301378301, 112.08384332442225 276.3026301378301, 114.08384332442225 276.3026301378301, 112.08384332442225 281.3026301378301, 110.08384332442225 282.3026301378301, 109.08384332442225 284.3026301378301, 108.08384332442225 287.3026301378301, 108.08384332442225 290.3026301378301, 105.08384332442225 296.3026301378301, 104.08384332442225 297.3026301378301, 103.08384332442225 297.3026301378301, 103.08384332442225 298.3026301378301, 104.08384332442225 299.3026301378301, 104.08384332442225 298.3026301378301, 104.08384332442225 300.3026301378301, 105.08384332442225 301.3026301378301, 104.08384332442225 304.3026301378301, 103.08384332442225 304.3026301378301, 104.08384332442225 303.3026301378301, 102.08384332442225 304.3026301378301, 102.08384332442225 303.3026301378301, 99.08384332442225 304.3026301378301, 97.08384332442225 301.3026301378301, 95.08384332442225 303.3026301378301, 96.08384332442225 301.3026301378301, 95.08384332442225 301.3026301378301, 94.08384332442225 301.3026301378301, 95.08384332442225 303.3026301378301, 94.08384332442225 303.3026301378301, 93.08384332442225 304.3026301378301, 92.08384332442225 305.3026301378301, 93.08384332442225 304.3026301378301, 93.08384332442225 303.3026301378301, 93.08384332442225 301.3026301378301, 92.08384332442225 301.3026301378301, 92.08384332442225 299.3026301378301, 92.08384332442225 301.3026301378301, 92.08384332442225 303.3026301378301, 91.08384332442225 305.3026301378301, 88.08384332442225 304.3026301378301, 90.08384332442225 303.3026301378301, 88.08384332442225 303.3026301378301, 88.08384332442225 304.3026301378301, 87.08384332442225 304.3026301378301, 86.08384332442225 304.3026301378301, 82.08384332442225 304.3026301378301, 80.08384332442225 305.3026301378301, 79.08384332442225 305.3026301378301, 77.08384332442225 305.3026301378301, 79.08384332442225 306.3026301378301, 80.08384332442225 307.3026301378301, 79.08384332442225 307.3026301378301, 79.08384332442225 308.3026301378301, 75.08384332442225 308.3026301378301, 75.08384332442225 310.3026301378301, 74.08384332442225 310.3026301378301, 73.08384332442225 310.3026301378301, 72.08384332442225 309.3026301378301, 72.08384332442225 310.3026301378301, 71.08384332442225 310.3026301378301, 72.08384332442225 311.3026301378301, 70.08384332442225 312.3026301378301, 69.08384332442225 314.3026301378301, 65.08384332442225 315.3026301378301, 64.08384332442225 314.3026301378301, 65.08384332442225 312.3026301378301, 66.08384332442225 311.3026301378301, 63.08384332442225 312.3026301378301, 61.08384332442225 311.3026301378301, 61.08384332442225 312.3026301378301, 62.08384332442225 312.3026301378301, 63.08384332442225 314.3026301378301, 63.08384332442225 315.3026301378301, 61.08384332442225 317.3026301378301, 60.08384332442225 317.3026301378301, 59.08384332442225 317.3026301378301, 58.08384332442225 317.3026301378301, 57.08384332442225 318.3026301378301, 57.08384332442225 320.3026301378301, 57.08384332442225 319.3026301378301, 54.08384332442225 319.3026301378301, 53.08384332442225 322.3026301378301, 52.08384332442225 322.3026301378301, 52.08384332442225 320.3026301378301, 50.08384332442225 320.3026301378301, 50.08384332442225 322.3026301378301, 49.08384332442225 322.3026301378301, 47.08384332442225 320.3026301378301, 46.08384332442225 322.3026301378301, 44.08384332442225 320.3026301378301, 44.08384332442225 322.3026301378301, 43.08384332442225 322.3026301378301, 43.08384332442225 321.3026301378301, 43.08384332442225 323.3026301378301, 42.08384332442225 323.3026301378301, 41.08384332442225 322.3026301378301, 41.08384332442225 323.3026301378301, 40.08384332442225 323.3026301378301, 39.08384332442225 322.3026301378301, 40.08384332442225 320.3026301378301, 39.08384332442225 319.3026301378301, 39.08384332442225 320.3026301378301, 38.08384332442225 320.3026301378301, 37.08384332442225 320.3026301378301, 37.08384332442225 322.3026301378301, 36.08384332442225 322.3026301378301, 35.08384332442225 322.3026301378301, 35.08384332442225 320.3026301378301, 32.08384332442225 322.3026301378301, 33.08384332442225 322.3026301378301, 31.083843324422247 322.3026301378301, 31.083843324422247 321.3026301378301, 30.083843324422247 322.3026301378301, 30.083843324422247 321.3026301378301, 32.08384332442225 319.3026301378301, 35.08384332442225 319.3026301378301, 37.08384332442225 317.3026301378301, 31.083843324422247 319.3026301378301, 30.083843324422247 319.3026301378301, 31.083843324422247 318.3026301378301, 32.08384332442225 317.3026301378301, 39.08384332442225 316.3026301378301, 39.08384332442225 315.3026301378301, 38.08384332442225 314.3026301378301, 38.08384332442225 312.3026301378301, 38.08384332442225 314.3026301378301, 37.08384332442225 316.3026301378301, 29.083843324422247 316.3026301378301, 29.083843324422247 317.3026301378301, 27.083843324422247 317.3026301378301, 26.083843324422247 317.3026301378301, 25.083843324422247 317.3026301378301, 25.083843324422247 316.3026301378301, 26.083843324422247 317.3026301378301, 26.083843324422247 316.3026301378301, 26.083843324422247 315.3026301378301, 28.083843324422247 315.3026301378301, 29.083843324422247 314.3026301378301, 28.083843324422247 314.3026301378301, 28.083843324422247 312.3026301378301, 30.083843324422247 311.3026301378301, 30.083843324422247 312.3026301378301, 30.083843324422247 311.3026301378301, 32.08384332442225 311.3026301378301, 31.083843324422247 311.3026301378301, 33.08384332442225 309.3026301378301, 36.08384332442225 309.3026301378301, 37.08384332442225 309.3026301378301, 35.08384332442225 309.3026301378301, 32.08384332442225 310.3026301378301, 31.083843324422247 310.3026301378301, 30.083843324422247 310.3026301378301, 25.083843324422247 312.3026301378301, 25.083843324422247 311.3026301378301, 24.083843324422247 311.3026301378301, 24.083843324422247 310.3026301378301, 25.083843324422247 309.3026301378301, 24.083843324422247 308.3026301378301, 22.083843324422247 309.3026301378301, 21.083843324422247 310.3026301378301, 21.083843324422247 308.3026301378301, 20.083843324422247 308.3026301378301, 20.083843324422247 306.3026301378301, 22.083843324422247 306.3026301378301, 24.083843324422247 306.3026301378301, 22.083843324422247 305.3026301378301, 24.083843324422247 304.3026301378301, 29.083843324422247 301.3026301378301, 30.083843324422247 300.3026301378301, 30.083843324422247 301.3026301378301, 31.083843324422247 299.3026301378301, 32.08384332442225 299.3026301378301, 35.08384332442225 299.3026301378301, 31.083843324422247 298.3026301378301, 30.083843324422247 298.3026301378301, 30.083843324422247 299.3026301378301, 29.083843324422247 298.3026301378301, 26.083843324422247 299.3026301378301, 25.083843324422247 298.3026301378301, 24.083843324422247 298.3026301378301, 22.083843324422247 298.3026301378301, 24.083843324422247 299.3026301378301, 21.083843324422247 298.3026301378301, 22.083843324422247 299.3026301378301, 20.083843324422247 299.3026301378301, 19.083843324422247 298.3026301378301, 19.083843324422247 297.3026301378301, 20.083843324422247 297.3026301378301, 19.083843324422247 296.3026301378301, 20.083843324422247 296.3026301378301, 20.083843324422247 297.3026301378301, 21.083843324422247 297.3026301378301, 21.083843324422247 295.3026301378301, 22.083843324422247 295.3026301378301, 24.083843324422247 294.3026301378301, 26.083843324422247 294.3026301378301, 26.083843324422247 295.3026301378301, 28.083843324422247 296.3026301378301, 29.083843324422247 294.3026301378301, 28.083843324422247 293.3026301378301, 29.083843324422247 292.3026301378301, 29.083843324422247 294.3026301378301, 30.083843324422247 296.3026301378301, 32.08384332442225 296.3026301378301, 35.08384332442225 296.3026301378301, 35.08384332442225 295.3026301378301, 31.083843324422247 295.3026301378301, 31.083843324422247 293.3026301378301, 32.08384332442225 294.3026301378301, 32.08384332442225 293.3026301378301, 33.08384332442225 290.3026301378301, 31.083843324422247 289.3026301378301, 36.08384332442225 288.3026301378301, 37.08384332442225 287.3026301378301, 38.08384332442225 288.3026301378301, 38.08384332442225 287.3026301378301, 37.08384332442225 287.3026301378301, 38.08384332442225 285.3026301378301, 39.08384332442225 285.3026301378301, 41.08384332442225 286.3026301378301, 41.08384332442225 285.3026301378301, 44.08384332442225 286.3026301378301, 50.08384332442225 284.3026301378301, 50.08384332442225 285.3026301378301, 51.08384332442225 285.3026301378301, 52.08384332442225 284.3026301378301, 54.08384332442225 284.3026301378301, 57.08384332442225 284.3026301378301, 53.08384332442225 283.3026301378301, 52.08384332442225 283.3026301378301, 52.08384332442225 282.3026301378301, 51.08384332442225 281.3026301378301, 50.08384332442225 281.3026301378301, 50.08384332442225 282.3026301378301, 47.08384332442225 285.3026301378301, 46.08384332442225 284.3026301378301, 44.08384332442225 286.3026301378301, 43.08384332442225 285.3026301378301, 44.08384332442225 284.3026301378301, 42.08384332442225 284.3026301378301, 40.08384332442225 284.3026301378301, 40.08384332442225 283.3026301378301, 39.08384332442225 282.3026301378301, 40.08384332442225 284.3026301378301, 37.08384332442225 284.3026301378301, 37.08384332442225 285.3026301378301, 32.08384332442225 284.3026301378301, 31.083843324422247 284.3026301378301, 35.08384332442225 284.3026301378301, 38.08384332442225 281.3026301378301, 39.08384332442225 279.3026301378301, 41.08384332442225 279.3026301378301, 41.08384332442225 277.3026301378301, 42.08384332442225 276.3026301378301, 42.08384332442225 274.3026301378301, 44.08384332442225 273.3026301378301, 43.08384332442225 273.3026301378301, 41.08384332442225 273.3026301378301, 42.08384332442225 272.3026301378301, 46.08384332442225 267.3026301378301, 49.08384332442225 267.3026301378301, 50.08384332442225 267.3026301378301, 52.08384332442225 267.3026301378301, 50.08384332442225 267.3026301378301, 52.08384332442225 267.3026301378301, 53.08384332442225 267.3026301378301, 53.08384332442225 266.3026301378301, 54.08384332442225 265.3026301378301, 53.08384332442225 265.3026301378301, 52.08384332442225 265.3026301378301, 52.08384332442225 264.3026301378301, 53.08384332442225 263.3026301378301, 53.08384332442225 262.3026301378301, 51.08384332442225 262.3026301378301, 49.08384332442225 263.3026301378301, 42.08384332442225 263.3026301378301, 41.08384332442225 263.3026301378301, 41.08384332442225 261.3026301378301, 40.08384332442225 263.3026301378301, 40.08384332442225 262.3026301378301, 40.08384332442225 261.3026301378301, 40.08384332442225 260.3026301378301, 41.08384332442225 260.3026301378301, 40.08384332442225 259.3026301378301, 40.08384332442225 260.3026301378301, 40.08384332442225 259.3026301378301, 39.08384332442225 260.3026301378301, 38.08384332442225 260.3026301378301, 37.08384332442225 259.3026301378301, 36.08384332442225 259.3026301378301, 36.08384332442225 257.3026301378301, 38.08384332442225 256.3026301378301, 36.08384332442225 256.3026301378301, 35.08384332442225 256.3026301378301, 35.08384332442225 257.3026301378301, 32.08384332442225 256.3026301378301, 31.083843324422247 255.3026301378301, 30.083843324422247 256.3026301378301, 30.083843324422247 255.3026301378301, 29.083843324422247 255.3026301378301, 30.083843324422247 253.3026301378301, 32.08384332442225 254.3026301378301, 31.083843324422247 253.3026301378301, 31.083843324422247 252.3026301378301, 30.083843324422247 251.3026301378301, 29.083843324422247 251.3026301378301, 31.083843324422247 251.3026301378301, 31.083843324422247 250.3026301378301, 35.08384332442225 251.3026301378301, 32.08384332442225 248.3026301378301, 37.08384332442225 248.3026301378301, 37.08384332442225 246.3026301378301, 37.08384332442225 244.3026301378301, 39.08384332442225 243.3026301378301, 41.08384332442225 244.3026301378301, 42.08384332442225 243.3026301378301, 41.08384332442225 243.3026301378301, 42.08384332442225 242.3026301378301, 41.08384332442225 242.3026301378301, 42.08384332442225 241.3026301378301, 42.08384332442225 240.3026301378301, 39.08384332442225 240.3026301378301, 38.08384332442225 240.3026301378301, 37.08384332442225 240.3026301378301, 37.08384332442225 238.3026301378301, 39.08384332442225 239.3026301378301, 39.08384332442225 237.3026301378301, 39.08384332442225 238.3026301378301, 39.08384332442225 237.3026301378301, 38.08384332442225 234.3026301378301, 38.08384332442225 233.3026301378301, 39.08384332442225 233.3026301378301, 38.08384332442225 233.3026301378301, 39.08384332442225 232.3026301378301, 38.08384332442225 232.3026301378301, 38.08384332442225 233.3026301378301, 37.08384332442225 232.3026301378301, 38.08384332442225 231.3026301378301, 37.08384332442225 231.3026301378301, 38.08384332442225 230.3026301378301, 37.08384332442225 230.3026301378301, 38.08384332442225 229.3026301378301, 36.08384332442225 228.3026301378301, 36.08384332442225 229.3026301378301, 36.08384332442225 230.3026301378301, 35.08384332442225 230.3026301378301, 35.08384332442225 231.3026301378301, 35.08384332442225 232.3026301378301, 33.08384332442225 232.3026301378301, 35.08384332442225 228.3026301378301, 33.08384332442225 227.3026301378301, 35.08384332442225 227.3026301378301, 37.08384332442225 224.3026301378301, 37.08384332442225 227.3026301378301, 38.08384332442225 228.3026301378301, 38.08384332442225 229.3026301378301, 37.08384332442225 228.3026301378301, 39.08384332442225 229.3026301378301, 39.08384332442225 227.3026301378301, 39.08384332442225 228.3026301378301, 39.08384332442225 227.3026301378301, 39.08384332442225 226.3026301378301, 39.08384332442225 224.3026301378301, 41.08384332442225 226.3026301378301, 46.08384332442225 226.3026301378301, 47.08384332442225 228.3026301378301, 49.08384332442225 227.3026301378301, 50.08384332442225 227.3026301378301, 50.08384332442225 228.3026301378301, 51.08384332442225 229.3026301378301, 51.08384332442225 230.3026301378301, 52.08384332442225 231.3026301378301, 54.08384332442225 228.3026301378301, 57.08384332442225 228.3026301378301, 59.08384332442225 230.3026301378301, 60.08384332442225 229.3026301378301, 61.08384332442225 230.3026301378301, 63.08384332442225 231.3026301378301, 64.08384332442225 231.3026301378301, 63.08384332442225 230.3026301378301, 64.08384332442225 229.3026301378301, 65.08384332442225 229.3026301378301, 64.08384332442225 228.3026301378301, 65.08384332442225 228.3026301378301, 64.08384332442225 227.3026301378301, 63.08384332442225 228.3026301378301, 62.08384332442225 227.3026301378301, 64.08384332442225 226.3026301378301, 64.08384332442225 224.3026301378301, 66.08384332442225 224.3026301378301, 65.08384332442225 223.3026301378301, 66.08384332442225 222.3026301378301, 66.08384332442225 223.3026301378301, 70.08384332442225 223.3026301378301, 71.08384332442225 221.3026301378301, 71.08384332442225 220.3026301378301, 73.08384332442225 218.3026301378301, 74.08384332442225 218.3026301378301, 73.08384332442225 218.3026301378301, 71.08384332442225 218.3026301378301, 70.08384332442225 218.3026301378301, 69.08384332442225 218.3026301378301, 66.08384332442225 220.3026301378301, 66.08384332442225 218.3026301378301, 69.08384332442225 218.3026301378301, 66.08384332442225 218.3026301378301, 64.08384332442225 218.3026301378301, 63.08384332442225 218.3026301378301, 60.08384332442225 216.3026301378301, 61.08384332442225 215.3026301378301, 60.08384332442225 215.3026301378301, 61.08384332442225 215.3026301378301, 61.08384332442225 213.3026301378301, 63.08384332442225 212.3026301378301, 68.08384332442225 213.3026301378301, 66.08384332442225 212.3026301378301, 65.08384332442225 212.3026301378301, 66.08384332442225 212.3026301378301, 69.08384332442225 213.3026301378301, 65.08384332442225 210.3026301378301, 66.08384332442225 210.3026301378301, 70.08384332442225 210.3026301378301, 69.08384332442225 209.3026301378301, 70.08384332442225 209.3026301378301, 71.08384332442225 209.3026301378301, 70.08384332442225 209.3026301378301, 69.08384332442225 208.3026301378301, 69.08384332442225 209.3026301378301, 68.08384332442225 208.3026301378301, 68.08384332442225 206.3026301378301, 70.08384332442225 206.3026301378301, 69.08384332442225 206.3026301378301, 68.08384332442225 204.3026301378301, 69.08384332442225 204.3026301378301, 69.08384332442225 202.3026301378301, 70.08384332442225 204.3026301378301, 70.08384332442225 202.3026301378301, 71.08384332442225 202.3026301378301, 71.08384332442225 201.3026301378301, 72.08384332442225 200.3026301378301, 74.08384332442225 200.3026301378301, 74.08384332442225 201.3026301378301, 75.08384332442225 200.3026301378301, 77.08384332442225 200.3026301378301, 77.08384332442225 198.3026301378301, 77.08384332442225 197.3026301378301, 79.08384332442225 198.3026301378301, 79.08384332442225 199.3026301378301, 80.08384332442225 199.3026301378301, 80.08384332442225 200.3026301378301, 81.08384332442225 200.3026301378301, 80.08384332442225 200.3026301378301, 81.08384332442225 200.3026301378301, 81.08384332442225 199.3026301378301, 80.08384332442225 199.3026301378301, 80.08384332442225 197.3026301378301, 81.08384332442225 197.3026301378301, 81.08384332442225 200.3026301378301, 82.08384332442225 200.3026301378301, 83.08384332442225 201.3026301378301, 83.08384332442225 202.3026301378301, 84.08384332442225 201.3026301378301, 83.08384332442225 198.3026301378301, 83.08384332442225 200.3026301378301, 83.08384332442225 199.3026301378301, 83.08384332442225 198.3026301378301, 82.08384332442225 198.3026301378301, 82.08384332442225 197.3026301378301, 83.08384332442225 197.3026301378301, 84.08384332442225 196.3026301378301, 85.08384332442225 197.3026301378301, 85.08384332442225 199.3026301378301, 86.08384332442225 201.3026301378301, 86.08384332442225 202.3026301378301, 84.08384332442225 205.3026301378301, 85.08384332442225 205.3026301378301, 84.08384332442225 205.3026301378301, 83.08384332442225 207.3026301378301, 85.08384332442225 205.3026301378301, 87.08384332442225 204.3026301378301, 87.08384332442225 201.3026301378301, 86.08384332442225 198.3026301378301, 87.08384332442225 198.3026301378301, 86.08384332442225 197.3026301378301, 87.08384332442225 197.3026301378301, 90.08384332442225 196.3026301378301, 90.08384332442225 197.3026301378301, 92.08384332442225 197.3026301378301, 90.08384332442225 196.3026301378301, 90.08384332442225 195.3026301378301, 90.08384332442225 194.3026301378301, 88.08384332442225 194.3026301378301, 92.08384332442225 194.3026301378301, 93.08384332442225 195.3026301378301, 94.08384332442225 196.3026301378301, 98.08384332442225 198.3026301378301, 98.08384332442225 199.3026301378301, 94.08384332442225 201.3026301378301 )";
    let a: LineString = wkt_a.into();
    let b: LineString = wkt_b.into();
    let expects = min_dist_brute_force(&a, &b);
    let actual = knn_min_linear_distance(&a.coordinates, &b.coordinates);
    assert_eq!(expects, actual);
    assert_eq!(b.distance(&a), actual);
    assert_eq!(a.distance(&b), actual);

    let wkt_a = "LINESTRING ( 107.40136085597902 264.4275018068343, 104.75816310001828 261.7843040508735, 100.499677826526 257.52581877738123, 95.06643799482896 252.0925789456842, 101.23389942540399 247.39356071286514, 105.27467042529447 243.22244226136527, 110.33824725149094 237.99552424722697, 107.97360483400409 233.15363739237296, 104.17078582091591 225.3669127465257, 107.33973515096297 223.0397155822724, 112.55672605179302 219.20848788947535, 114.73295654185358 217.61031862333712, 118.38485017243461 214.9284592383792, 122.96685875219221 211.5635466876197, 129.01219223364694 213.86653087103102, 135.30178161334229 216.26256492043876, 135.48601339593614 223.90818389808322, 135.68422020736688 232.13376657245925, 135.8042861563376 237.11650345474465, 135.88915889244467 240.6387220031877, 142.18950024983 242.6188292869374, 146.1682612767364 243.86929703825083, 150.0675155613293 244.623991415914, 155.27260910282334 245.631428875558, 154.86258122926995 253.5244654414607, 154.49661900188642 260.5692383185941, 154.32924858795883 263.7911187867, 154.09785454461857 268.2454541209998, 150.84751029246013 272.4058947637626, 148.34073794456262 275.61456336907145, 146.75563855583877 277.64349058663794 )";
    let wkt_b = "LINESTRING ( 52.1878966203549 219.49313995550187, 53.260963609142806 225.7782466041168, 54.24371709721324 231.53437417710074, 58.05716742141267 234.89021046239623, 61.58593308599305 237.99552424722697, 69.51552635387523 233.2965060144079, 71.57134683073357 226.83535594428167, 68.63446043522165 218.3183853972971, 75.62091956681317 215.63128573130038, 80.08831737771816 213.91305580402923, 82.83034092514804 217.96648191762122, 86.84315608739557 223.89846954876975, 86.08115313072221 228.47048728880992, 85.08102425008842 234.47126057261266, 81.43928511965365 241.75473883348224, 78.326185540411 247.98093799196752, 80.73443238473078 255.20567852492684, 82.43782649412769 260.31586085311756, 88.33384168439049 269.9460189972135, 91.24848568066345 274.706604191126, 85.24711463929152 277.3542678858489, 76.92473142408778 281.0259075396153, 71.27765819118238 283.5172633776618, 63.38684183989868 278.15746359188415, 60.29270145419589 276.05578332989734, 55.7121602949692 272.94447235381887, 52.51288945440425 276.56469988393184, 49.896536605976145 279.52530968610046, 47.16834484045201 282.61247405235144, 44.5519919920239 285.5730838545201, 44.25830335247271 291.44685664554396, 48.66363294574059 295.85218623881184, 52.48158525990609 299.67013855297733, 58.67648919802438 299.0744747127737, 67.75339451656808 298.2016953552214, 73.43712313100995 295.95811827057327, 78.91356281951339 293.7963657619535, 80.79431029395924 290.7513460414221, 85.08102425008842 283.81095201721297, 90.5706205504561 285.50005857117225, 100.35283350675041 288.50997025003204, 105.69430411689717 287.6971377658793, 113.86251092610524 286.4541497731737, 115.30324764843185 281.4115712450306, 116.87697545281937 275.9035239296743, 118.4285380768634 270.47305474552013, 119.73628371712908 265.89594500459026, 120.91103827533387 261.7843040508735 )";
    let a = LineString::from_wkt(wkt_a);
    let b = LineString::from_wkt(wkt_b);
    let expects = min_dist_brute_force(&a, &b);
    let actual = knn_min_linear_distance(&a.coordinates, &b.coordinates);
    assert_eq!(expects, actual);
    assert_eq!(b.distance(&a), actual);
    assert_eq!(a.distance(&b), actual);

    let wkt_b = "LINESTRING ( 190.5152458489664 281.16775426125224, 182.87934122063538 276.175047388882, 188.75311401165925 269.42020867920456, 193.45213224447832 269.12652003965337, 193.7458208840295 263.8401245277319, 188.16573673255687 259.1411062949128, 183.17302986018657 261.7843040508735, 177.88663434826512 255.9105312598497, 184.93516169749373 248.8620039106211, 193.7458208840295 252.0925789456842 )";
    let wkt_a = "LINESTRING ( 184.05409577884015 283.2235747381106, 176.41819115050916 278.8182451448427, 176.41819115050916 273.23816099337006, 180.52983210422585 270.59496323740933, 181.9982753019818 268.2454541209998, 180.82352074377704 265.60225636503907, 175.2434365923044 264.1338131672831, 171.1317956385877 260.02217221356636, 172.30655019679247 255.9105312598497, 176.71187979006035 250.33044710837706, 179.94245482512346 243.86929703825083, 188.75311401165925 242.10716520094365 )";
    let a = LineString::from_wkt(wkt_a);
    let b = LineString::from_wkt(wkt_b);
    let expects = min_dist_brute_force(&a, &b);
    let actual = knn_min_linear_distance(&a.coordinates, &b.coordinates);
    assert_eq!(expects, actual);
    assert_eq!(b.distance(&a), actual);
    assert_eq!(a.distance(&b), actual);

    let wkt_b = "LINESTRING ( 190.5152458489664 281.16775426125224, 182.87934122063538 276.175047388882, 188.75311401165925 269.42020867920456, 193.45213224447832 269.12652003965337, 193.7458208840295 263.8401245277319, 188.16573673255687 259.1411062949128, 183.17302986018657 261.7843040508735, 177.88663434826512 255.9105312598497, 184.93516169749373 248.8620039106211, 193.7458208840295 252.0925789456842 )";
    let wkt_a = "LINESTRING ( 184.05409577884015 283.2235747381106, 176.41819115050916 278.8182451448427, 176.41819115050916 273.23816099337006, 180.52983210422585 270.59496323740933, 181.9982753019818 268.2454541209998, 180.82352074377704 265.60225636503907, 175.2434365923044 264.1338131672831, 171.1317956385877 260.02217221356636, 172.30655019679247 255.9105312598497, 176.71187979006035 250.33044710837706, 179.94245482512346 243.86929703825083, 188.75311401165925 242.10716520094365 )";
    let ag: LineString = wkt_a.into();
    let bg: LineString = wkt_b.into();
    let expects = ag.distance(&bg);
    let actual = knn_min_linear_distance(&ag.coordinates, &bg.coordinates);
    assert_eq!(expects, actual);
    assert_eq!(bg.distance(&ag), actual);
    assert_eq!(ag.distance(&bg), actual);
}

#[test]
fn test_to_segment_intersection() {
    let fn_segment = |wkt: &str| {
        let ln: LineString = wkt.into();
        segment::Segment::new(ln.coordinates[0], ln.coordinates[1])
    };

    let l0 = fn_segment("LINESTRING ( 350 350, 450 350 )");
    let l1 = fn_segment("LINESTRING ( 400.5652173913044 350, 550 350 )");
    let l2 = fn_segment("LINESTRING ( 350 450, 350 300 )");
    let l3 = fn_segment("LINESTRING ( 450 350, 450 450 )");
    let l4 = fn_segment("LINESTRING ( 400 300, 500 400 )");
    let l5 = fn_segment("LINESTRING ( 400 450, 400 250 )");
    let l6 = fn_segment("LINESTRING ( 300 450, 350 350 )");
    let l7 = fn_segment("LINESTRING ( 450 350, 600 350 )");
    let l8 = fn_segment("LINESTRING ( 450 350, 450 350 )");
    let l9 = fn_segment("LINESTRING (350 350, 350 350 )");
    let l10 = fn_segment("LINESTRING ( 350 350, 450 350 )");
    let l11 = fn_segment("LINESTRING (350 350, 350 350 )");
    let l12 = fn_segment("LINESTRING ( 400 350, 450 350 )");

    let intpts = segment::intersection(l0.a(), l0.b(), l1.a(), l1.b());
    let mut intpts= vec![intpts[1], intpts[0]];
    intpts.sort();
    assert_eq!(intpts[0].cmp(&intpts[1]), Ordering::Less);
    assert_eq!(intpts.len(), 2);
    assert_eq!(intpts[0].is_vertex(), true);
    assert_eq!(intpts[0].inter, inter::OTHER_A);
    assert_eq!(intpts[0].is_vertex_self(), false);
    assert_eq!(intpts[0].is_vertex_other(), true);
    assert_eq!(intpts[0].is_vertex_xor(), true);

    assert_eq!(intpts[0], inter::InterPoint {
        pt: Point { x: 400.5652173913044, y: 350. },
        inter: inter::OTHER_A
    });

    assert_eq!(intpts[1].inter, inter::SELF_B);
    assert_eq!(intpts[1].is_vertex(), true);
    assert_eq!(intpts[1].is_vertex_self(), true);
    assert_eq!(intpts[1].is_vertex_other(), false);
    assert_eq!(intpts[1].is_vertex_xor(), true);


    let intpts = segment::intersection(l0.a(), l0.b(), l2.a(), l2.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].is_vertex(), true);
    assert_eq!(intpts[0].inter, inter::SELF_A);

    let intpts = segment::intersection(l0.a(), l0.b(), l3.a(), l3.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].is_vertex(), true);
    assert_eq!(intpts[0].inter, inter::SELF_B | inter::OTHER_A);
    assert_eq!(intpts[0].is_vertex_xor(), false);


    let intpts = segment::intersection(l0.a(), l0.b(), l4.a(), l4.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].is_vertex(), true);
    assert_eq!(intpts[0].inter, inter::SELF_B);

    let intpts = segment::intersection(l0.a(), l0.b(), l5.a(), l5.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].is_intersection(), true);
    assert_eq!(intpts[0].inter, inter::INTER_X);
    assert_eq!(intpts[0].is_vertex_xor(), false);


    let intpts = segment::intersection(l0.a(), l0.b(), l6.a(), l6.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].is_vertex(), true);
    assert_eq!(intpts[0].inter, inter::SELF_A | inter::OTHER_B);

    let intpts = segment::intersection(l0.a(), l0.b(), l7.a(), l7.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].inter, inter::SELF_B | inter::OTHER_A);
    assert_eq!(intpts[0].is_vertex(), true);

    let intpts = segment::intersection(l0.a(), l0.b(), l8.a(), l8.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].inter, inter::SELF_B | inter::OTHER_A | inter::OTHER_B);

    let intpts = segment::intersection(l0.a(), l0.b(), l9.a(), l9.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].inter, inter::SELF_A | OTHER_A | inter::OTHER_B);

    let intpts = segment::intersection(l0.a(), l0.b(), l10.a(), l10.b());
    assert_eq!(intpts.len(), 2);
    assert_eq!(intpts[0].inter, inter::SELF_A | inter::OTHER_A);
    assert_eq!(intpts[1].inter, inter::SELF_B | inter::OTHER_B);

    let intpts = segment::intersection(l9.a(), l9.b(), l11.a(), l11.b());
    assert_eq!(intpts.len(), 1);
    assert_eq!(intpts[0].inter, inter::SELF_A | inter::SELF_B | inter::OTHER_A | inter::OTHER_B);

    let intpts = segment::intersection(l0.a(), l0.b(), l12.a(), l12.b());
    assert_eq!(intpts.len(), 2);
    assert_eq!(intpts[0].inter, inter::OTHER_A);
    assert_eq!(intpts[1].inter, inter::SELF_B | inter::OTHER_B);

    assert_eq!(intpts[0].to_string(), "[400, 350, 0010]".to_string());
    assert_eq!(intpts[1].to_string(), "[450, 350, 0101]".to_string());
}